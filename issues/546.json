{
    "assignee": null,
    "body": "Hey\r\nquick description of what I want to do:\r\nI hooked the onGetMessage Event and now I want to listen for incoming commands. Currently I simply try to send a message to a /hi command, first I had the following problem:\r\n\r\n```php\r\nPHP Notice:  Undefined variable: wa in /bot.php on line 71\r\nPHP Fatal error:  Call to a member function sendMessage() on a non-object in bot.php on line 71\r\n```\r\n\r\nOn that code:\r\n```php\r\nfunction onGetGroupMessage($myphone, $from_group_jid, $from_user_jid, $id, $type, $time, $name, $body) {\r\n    $msgsender = explode(\"-\",$from_group_jid);\r\n    echo \"[DEBUG | onGetGroupMessage] $myphone, $from_group_jid -> \".$msgsender[0].\", $id, $type, $time, $name, $body\\n\";\r\n    if(!empty($body)) {\r\n        $firstChar = substr($body,0,1);\r\n        if($firstChar=='/') {\r\n            if(strtolower($body)=='/hi') {\r\n                echo \"[DEBUG] Command /hi von \".$name.\" eingegangen\\n\";\r\n                $wa->sendMessage($msgsender[0], 'Hey du:)');\r\n            }\r\n        } \r\n    }\r\n}\r\n```\r\n\r\nI fixed that more or less, I think I just did a work around by adding that before sending the message:\r\n```php\r\n$wa = new WhatsProt(WA_SENDER, WA_IMEI, WA_NICKNAME, FALSE);\r\n$wa->Connect();\r\n$wa->LoginWithPassword(WA_PASSWORD);\r\n```\r\n\r\nMy problem now is that after the message got sent, it isn't able to listen for incoming commands / or messages anymore.\r\nAny solution? Or any other way to prevent that error, without needing to do my workaround (Cause I don't think that it's right anyway)",
    "closed_at": "2013-12-23T19:19:41Z",
    "comment_data": [
        {
            "body": "That fatal error is a null poiner exception which kills your application, which is why you can't do anything after that.\r\n\r\nYour function tries to call variable $wa which does not exist inside its scope. You need to either create a static instance wrapper which holds your WhatsProt object, make $wa a global variable, or pass $wa as an argument to the function.\r\n\r\nStatic instance class:\r\n```php\r\npublic class WhatsInstance\r\n{\r\n    protected static $instance;\r\n    public static function setInstance($wa)\r\n    {\r\n        self::$instance = $wa;\r\n    }\r\n    public static function getInstance()\r\n    {\r\n        return self::$instance;\r\n    }\r\n}\r\n\r\n//program code\r\n$wa =  new WhatsProt(bla, bla, bla);\r\nWhatsInstance::setInstance($wa);\r\n\r\nWhatsInstance::getInstance()->connect();\r\nWhatsInstance::getInstance()->loginWithPassword($password);\r\netc.\r\n\r\nfunction onMessage(bla, bla, bla, etc)\r\n{\r\n    //do stuff\r\n    ...\r\n\r\n    if(WhatsInstance::getInstance() != null)\r\n    {\r\n        WhatsInstance::getInstance()->sendMessage($to, $message);\r\n    }\r\n}\r\n```",
            "created_at": "2013-12-12T18:12:26Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/issues/546#issuecomment-30446852",
            "id": 30446852,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/546",
            "updated_at": "2013-12-12T18:15:46Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/30446852",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1610953?v=3",
                "events_url": "https://api.github.com/users/shirioko/events{/privacy}",
                "followers_url": "https://api.github.com/users/shirioko/followers",
                "following_url": "https://api.github.com/users/shirioko/following{/other_user}",
                "gists_url": "https://api.github.com/users/shirioko/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/shirioko",
                "id": 1610953,
                "login": "shirioko",
                "organizations_url": "https://api.github.com/users/shirioko/orgs",
                "received_events_url": "https://api.github.com/users/shirioko/received_events",
                "repos_url": "https://api.github.com/users/shirioko/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/shirioko/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/shirioko/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/shirioko"
            }
        },
        {
            "body": "I tried the idea with the class setup and didn't worked well for me.\r\nNever worked before class orieanted in php, so yeah...\r\nTried to create a test.class.php with following content:\r\n```php\r\n<?php\r\npublic class WhatsInstance\r\n{\r\n\tprotected static $instance;\r\n\tpublic static function setInstance($wa)\r\n\t{\r\n\t\tself::$instance = $wa;\r\n\t}\r\n\tpublic static function getInstance()\r\n\t{\r\n\t\treturn self::$instance;\r\n\t}\r\n}\r\n?>\r\n```\r\n\r\nAnd the following in my code:\r\n```php\r\nrequire_once 'test.class.php';\r\n//----------other code...\r\n$wa = new WhatsProt(WA_SENDER, WA_IMEI, WA_NICKNAME, FALSE);\r\nWhatsInstance::setInstance($wa);\r\n//Events binden\r\nWhatsInstance::getInstance()->eventManager()->bind('onGetMessage', 'onGetMessage');\r\nWhatsInstance::getInstance()->Connect();\r\nWhatsInstance::getInstance()->LoginWithPassword(WA_PASSWORD);\r\n```\r\n\r\n\r\nI got that error:\r\n```php\r\n\r\nPHP Parse error:  syntax error, unexpected T_PUBLIC in test.class.php on line 2\r\n```",
            "created_at": "2013-12-12T20:31:58Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/issues/546#issuecomment-30458940",
            "id": 30458940,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/546",
            "updated_at": "2013-12-12T20:31:58Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/30458940",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/604766?v=3",
                "events_url": "https://api.github.com/users/DurtyFree/events{/privacy}",
                "followers_url": "https://api.github.com/users/DurtyFree/followers",
                "following_url": "https://api.github.com/users/DurtyFree/following{/other_user}",
                "gists_url": "https://api.github.com/users/DurtyFree/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/DurtyFree",
                "id": 604766,
                "login": "DurtyFree",
                "organizations_url": "https://api.github.com/users/DurtyFree/orgs",
                "received_events_url": "https://api.github.com/users/DurtyFree/received_events",
                "repos_url": "https://api.github.com/users/DurtyFree/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/DurtyFree/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/DurtyFree/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/DurtyFree"
            }
        },
        {
            "body": "Remove \"public\" in front of the class declaration.\r\n\r\nThat's what I get for working with multiple languages. PHP and C#... :')",
            "created_at": "2013-12-13T08:42:22Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/issues/546#issuecomment-30494252",
            "id": 30494252,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/546",
            "updated_at": "2013-12-13T08:42:22Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/30494252",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1610953?v=3",
                "events_url": "https://api.github.com/users/shirioko/events{/privacy}",
                "followers_url": "https://api.github.com/users/shirioko/followers",
                "following_url": "https://api.github.com/users/shirioko/following{/other_user}",
                "gists_url": "https://api.github.com/users/shirioko/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/shirioko",
                "id": 1610953,
                "login": "shirioko",
                "organizations_url": "https://api.github.com/users/shirioko/orgs",
                "received_events_url": "https://api.github.com/users/shirioko/received_events",
                "repos_url": "https://api.github.com/users/shirioko/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/shirioko/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/shirioko/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/shirioko"
            }
        },
        {
            "body": "Already managed to do that via \"$GLOBALS[\"wa\"]->Connect();\" etc. \r\nMy question now is, whats the difference between using global variables and the class thing? Is it better to work with the class example you commented?",
            "created_at": "2013-12-13T13:12:00Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/issues/546#issuecomment-30508065",
            "id": 30508065,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/546",
            "updated_at": "2013-12-13T13:12:00Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/30508065",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/604766?v=3",
                "events_url": "https://api.github.com/users/DurtyFree/events{/privacy}",
                "followers_url": "https://api.github.com/users/DurtyFree/followers",
                "following_url": "https://api.github.com/users/DurtyFree/following{/other_user}",
                "gists_url": "https://api.github.com/users/DurtyFree/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/DurtyFree",
                "id": 604766,
                "login": "DurtyFree",
                "organizations_url": "https://api.github.com/users/DurtyFree/orgs",
                "received_events_url": "https://api.github.com/users/DurtyFree/received_events",
                "repos_url": "https://api.github.com/users/DurtyFree/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/DurtyFree/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/DurtyFree/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/DurtyFree"
            }
        },
        {
            "body": "Both should work about the same.",
            "created_at": "2013-12-23T17:47:53Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/issues/546#issuecomment-31132988",
            "id": 31132988,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/546",
            "updated_at": "2013-12-23T17:47:53Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/31132988",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1610953?v=3",
                "events_url": "https://api.github.com/users/shirioko/events{/privacy}",
                "followers_url": "https://api.github.com/users/shirioko/followers",
                "following_url": "https://api.github.com/users/shirioko/following{/other_user}",
                "gists_url": "https://api.github.com/users/shirioko/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/shirioko",
                "id": 1610953,
                "login": "shirioko",
                "organizations_url": "https://api.github.com/users/shirioko/orgs",
                "received_events_url": "https://api.github.com/users/shirioko/received_events",
                "repos_url": "https://api.github.com/users/shirioko/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/shirioko/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/shirioko/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/shirioko"
            }
        }
    ],
    "comments": 5,
    "comments_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/546/comments",
    "created_at": "2013-12-12T17:25:09Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/604766?v=3",
                "events_url": "https://api.github.com/users/DurtyFree/events{/privacy}",
                "followers_url": "https://api.github.com/users/DurtyFree/followers",
                "following_url": "https://api.github.com/users/DurtyFree/following{/other_user}",
                "gists_url": "https://api.github.com/users/DurtyFree/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/DurtyFree",
                "id": 604766,
                "login": "DurtyFree",
                "organizations_url": "https://api.github.com/users/DurtyFree/orgs",
                "received_events_url": "https://api.github.com/users/DurtyFree/received_events",
                "repos_url": "https://api.github.com/users/DurtyFree/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/DurtyFree/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/DurtyFree/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/DurtyFree"
            },
            "commit_id": null,
            "created_at": "2013-12-23T19:19:41Z",
            "event": "closed",
            "id": 83129948,
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/events/83129948"
        }
    ],
    "events_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/546/events",
    "html_url": "https://github.com/venomous0x/WhatsAPI/issues/546",
    "id": 24193994,
    "labels": [],
    "labels_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/546/labels{/name}",
    "locked": false,
    "milestone": null,
    "number": 546,
    "state": "closed",
    "title": "How to: Send message?",
    "updated_at": "2013-12-23T19:19:41Z",
    "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/546",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/604766?v=3",
        "events_url": "https://api.github.com/users/DurtyFree/events{/privacy}",
        "followers_url": "https://api.github.com/users/DurtyFree/followers",
        "following_url": "https://api.github.com/users/DurtyFree/following{/other_user}",
        "gists_url": "https://api.github.com/users/DurtyFree/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/DurtyFree",
        "id": 604766,
        "login": "DurtyFree",
        "organizations_url": "https://api.github.com/users/DurtyFree/orgs",
        "received_events_url": "https://api.github.com/users/DurtyFree/received_events",
        "repos_url": "https://api.github.com/users/DurtyFree/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/DurtyFree/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/DurtyFree/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/DurtyFree"
    }
}