{
    "assignee": null,
    "body": "Hi,\r\n\r\nWhenever I open the script, this happens:\r\n```\r\nPHP Warning:  array_map(): An error occurred while invoking the map callback in /home/sydcul/WhatsAPI-master/src/php/WhatsAppEvent.php on line 99\r\nPHP Fatal error:  Uncaught exception 'Exception' with message 'BinTreeNodeReader->readListSize: Invalid token 78' in /home/sydcul/WhatsAPI-master/src/php/protocol.class.php:392\r\nStack trace:\r\n#0 /home/sydcul/WhatsAPI-master/src/php/protocol.class.php(346): BinTreeNodeReader->readListSize(78)\r\n#1 /home/sydcul/WhatsAPI-master/src/php/protocol.class.php(280): BinTreeNodeReader->nextTreeInternal()\r\n#2 /home/sydcul/WhatsAPI-master/src/php/whatsprot.class.php(1743): BinTreeNodeReader->nextTree('?????6???q??:q?...')\r\n#3 /home/sydcul/WhatsAPI-master/src/php/whatsprot.class.php(462): WhatsProt->processInboundData('?????6???q??:q?...')\r\n#4 /home/sydcul/WhatsAPI-master/src/php/whatsprot.class.php(1344): WhatsProt->pollMessages()\r\n#5 /home/sydcul/WhatsAPI-master/src/php/whatsprot.class.php(2528): WhatsProt->waitForServer('message-1389639...')\r\n#6 /home/sydcul/WhatsAPI-master/src/php/whatsprot.class.php(936): WhatsProt->sendMessageNode('a_phone_number_which_is_always_the_same@s.w...', Object(ProtocolNode), NULL)\r\n#7 /home/sydcul/WhatsAPI-master/src/php/bot.php(95): WhatsProt- in /home/sydcul/WhatsAPI-master/src/php/protocol.class.php on line 392\r\n```\r\nSometimes when I restart the script it tells me nothing, but it does not work and whenever I send a message to the script it only gives me 1 check mark out of 2.\r\n\r\nI guess it is stuck while retrieving the messages from the whapp servers.\r\n\r\nMy code: http://pastebin.com/Qk7T3pPw (derp is obviously a placeholder)\r\n\r\nThe problems started when someone spammed me, I read putting the messages in a queue solves the problem, well, no, besides from being a good practice I guess. I am working on a spam blocker, but this must be an error in the code, so I'd rather have it fixed anyway.\r\n\r\nEDIT: @shirioko told me to put the message poll after the queue stuff, well that didn't work either.",
    "closed_at": null,
    "comment_data": [
        {
            "body": "Solved it by adding a 1sec interval before processing each message in the queue. This is kind of a tricky thing, tho. 0,5sec does not work, for example.\r\nEDIT: Well still not solved. I'm kinda unstatisfied with putting the PHP in a bash while-true loop which restarts it when it fails.",
            "created_at": "2014-01-14T18:45:33Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/issues/574#issuecomment-32293815",
            "id": 32293815,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/574",
            "updated_at": "2014-01-14T20:51:33Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/32293815",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1252824?v=3",
                "events_url": "https://api.github.com/users/Sydcul/events{/privacy}",
                "followers_url": "https://api.github.com/users/Sydcul/followers",
                "following_url": "https://api.github.com/users/Sydcul/following{/other_user}",
                "gists_url": "https://api.github.com/users/Sydcul/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/Sydcul",
                "id": 1252824,
                "login": "Sydcul",
                "organizations_url": "https://api.github.com/users/Sydcul/orgs",
                "received_events_url": "https://api.github.com/users/Sydcul/received_events",
                "repos_url": "https://api.github.com/users/Sydcul/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/Sydcul/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/Sydcul/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/Sydcul"
            }
        }
    ],
    "comments": 1,
    "comments_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/574/comments",
    "created_at": "2014-01-13T19:07:50Z",
    "event_data": [],
    "events_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/574/events",
    "html_url": "https://github.com/venomous0x/WhatsAPI/issues/574",
    "id": 25520072,
    "labels": [],
    "labels_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/574/labels{/name}",
    "locked": false,
    "milestone": null,
    "number": 574,
    "state": "open",
    "title": "Crash on message poll",
    "updated_at": "2014-01-14T20:51:33Z",
    "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/574",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/1252824?v=3",
        "events_url": "https://api.github.com/users/Sydcul/events{/privacy}",
        "followers_url": "https://api.github.com/users/Sydcul/followers",
        "following_url": "https://api.github.com/users/Sydcul/following{/other_user}",
        "gists_url": "https://api.github.com/users/Sydcul/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/Sydcul",
        "id": 1252824,
        "login": "Sydcul",
        "organizations_url": "https://api.github.com/users/Sydcul/orgs",
        "received_events_url": "https://api.github.com/users/Sydcul/received_events",
        "repos_url": "https://api.github.com/users/Sydcul/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/Sydcul/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/Sydcul/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/Sydcul"
    }
}