{
    "assignee": null,
    "body": "Hi folks,\r\n\r\nOn my project I use various events such as \"onSendMessage\", \"onMessageReceivedServer\", or \"onMessageReceivedClient\". Anywhere \"onSendMessage\" is placed, it is always executed after \"onMessageReceivedServer\". \r\n\r\nIs that how \"onSendMessage\" works or is the issue coming from my implementation?\r\n\r\nThank you for you suggestion, I struggle with that.\r\nBest regards.\r\n\r\nedit: more explicit title",
    "closed_at": null,
    "comment_data": [
        {
            "body": "```\r\n$w = new WhatsProt($sender, $imei, $nickname, FALSE);\r\n$w->Connect();\r\n$w->LoginWithPassword($password);\r\n$w->eventManager()->bind(\"onGetMessage\", \"onMessage\");\r\n$w->eventManager()->bind(\"onSendMessage\", \"onMessageSent\");\r\n$w->eventManager()->bind(\"onMessageReceivedServer\", \"onServerReceived\");\r\n$w->eventManager()->bind(\"onMessageReceivedClient\", \"onClientReceived\");\r\n```\r\nWhen I send a message after that, onServerreceived is always executed before onMessageSent, so, is this the normal behaviour or did I missed something? ",
            "created_at": "2013-10-24T08:49:33Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/issues/499#issuecomment-26975705",
            "id": 26975705,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/499",
            "updated_at": "2013-10-24T08:49:33Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/26975705",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/5312598?v=3",
                "events_url": "https://api.github.com/users/slobo42/events{/privacy}",
                "followers_url": "https://api.github.com/users/slobo42/followers",
                "following_url": "https://api.github.com/users/slobo42/following{/other_user}",
                "gists_url": "https://api.github.com/users/slobo42/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/slobo42",
                "id": 5312598,
                "login": "slobo42",
                "organizations_url": "https://api.github.com/users/slobo42/orgs",
                "received_events_url": "https://api.github.com/users/slobo42/received_events",
                "repos_url": "https://api.github.com/users/slobo42/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/slobo42/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/slobo42/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/slobo42"
            }
        },
        {
            "body": "https://github.com/venomous0x/WhatsAPI/blob/master/src/php/whatsprot.class.php#L2316\r\nyes this in normal behaviour, at least as far as the current implementation is written\r\nwaitForServer is called first, which will return the server received node and fire the event",
            "created_at": "2013-10-24T09:29:51Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/issues/499#issuecomment-26978105",
            "id": 26978105,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/499",
            "updated_at": "2013-10-24T09:33:14Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/26978105",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1610953?v=3",
                "events_url": "https://api.github.com/users/shirioko/events{/privacy}",
                "followers_url": "https://api.github.com/users/shirioko/followers",
                "following_url": "https://api.github.com/users/shirioko/following{/other_user}",
                "gists_url": "https://api.github.com/users/shirioko/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/shirioko",
                "id": 1610953,
                "login": "shirioko",
                "organizations_url": "https://api.github.com/users/shirioko/orgs",
                "received_events_url": "https://api.github.com/users/shirioko/received_events",
                "repos_url": "https://api.github.com/users/shirioko/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/shirioko/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/shirioko/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/shirioko"
            }
        },
        {
            "body": "Thank you so much for your answer! I was not looking in the right place. I test a quick fix by moving the fired eventManager() before the waitForServer (need to read more thoroughly whatsprot.class if it is a good idea). \r\n\r\nIf maybe you ask yourself why I needed that behavior, when I am in the onSendMessage event I insert into my database the information on the message (phone, message and the most important, the msg-id that we requested several days ago) and on the onMessageReceivedServer/Client I update a flag to know where is the message currently. (I don't know if it is relevant, but when working with a database I guess it's not that bad that the event onSendMessage is exectued before the two others quoted). Best regards.\r\n\r\n",
            "created_at": "2013-10-24T10:05:13Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/issues/499#issuecomment-26980162",
            "id": 26980162,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/499",
            "updated_at": "2013-10-24T10:05:13Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/26980162",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/5312598?v=3",
                "events_url": "https://api.github.com/users/slobo42/events{/privacy}",
                "followers_url": "https://api.github.com/users/slobo42/followers",
                "following_url": "https://api.github.com/users/slobo42/following{/other_user}",
                "gists_url": "https://api.github.com/users/slobo42/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/slobo42",
                "id": 5312598,
                "login": "slobo42",
                "organizations_url": "https://api.github.com/users/slobo42/orgs",
                "received_events_url": "https://api.github.com/users/slobo42/received_events",
                "repos_url": "https://api.github.com/users/slobo42/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/slobo42/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/slobo42/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/slobo42"
            }
        },
        {
            "body": "I think you might consider using the current implementation instead. If the message isn't received by the server then there's no reason to save it to database, unless you want to try sending it again later. :)",
            "created_at": "2013-10-24T10:13:14Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/issues/499#issuecomment-26980625",
            "id": 26980625,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/499",
            "updated_at": "2013-10-24T10:13:14Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/26980625",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1610953?v=3",
                "events_url": "https://api.github.com/users/shirioko/events{/privacy}",
                "followers_url": "https://api.github.com/users/shirioko/followers",
                "following_url": "https://api.github.com/users/shirioko/following{/other_user}",
                "gists_url": "https://api.github.com/users/shirioko/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/shirioko",
                "id": 1610953,
                "login": "shirioko",
                "organizations_url": "https://api.github.com/users/shirioko/orgs",
                "received_events_url": "https://api.github.com/users/shirioko/received_events",
                "repos_url": "https://api.github.com/users/shirioko/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/shirioko/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/shirioko/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/shirioko"
            }
        }
    ],
    "comments": 4,
    "comments_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/499/comments",
    "created_at": "2013-10-22T15:21:39Z",
    "event_data": [],
    "events_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/499/events",
    "html_url": "https://github.com/venomous0x/WhatsAPI/issues/499",
    "id": 21389611,
    "labels": [],
    "labels_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/499/labels{/name}",
    "locked": false,
    "milestone": null,
    "number": 499,
    "state": "open",
    "title": "is onMessageReceivedServer executed always after onSendMessage?",
    "updated_at": "2013-10-24T10:13:14Z",
    "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/499",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/5312598?v=3",
        "events_url": "https://api.github.com/users/slobo42/events{/privacy}",
        "followers_url": "https://api.github.com/users/slobo42/followers",
        "following_url": "https://api.github.com/users/slobo42/following{/other_user}",
        "gists_url": "https://api.github.com/users/slobo42/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/slobo42",
        "id": 5312598,
        "login": "slobo42",
        "organizations_url": "https://api.github.com/users/slobo42/orgs",
        "received_events_url": "https://api.github.com/users/slobo42/received_events",
        "repos_url": "https://api.github.com/users/slobo42/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/slobo42/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/slobo42/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/slobo42"
    }
}