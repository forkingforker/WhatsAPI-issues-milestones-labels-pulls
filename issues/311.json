{
    "assignee": null,
    "body": "Update checkCredentials() to work correctly",
    "closed_at": "2013-06-18T20:41:52Z",
    "comment_data": [
        {
            "body": "you have to encrypt $this->_identity\r\n\r\nThis is the method:\r\n\r\npublic function encryptIMEI()\r\n{\r\n    \tif(stripos($this->_identity, \":\") !== false)\r\n        {\r\n    \t\t$this->_identity = strtoupper($this->_identity);\r\n    \t\treturn md5($this->_identity.$this->_identity);\r\n    \t}\r\n        else\r\n       {\r\n        \treturn md5(strrev($this->_identity));\r\n        }\r\n}\r\n\r\n",
            "created_at": "2013-04-17T20:48:21Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/pull/311#issuecomment-16534726",
            "id": 16534726,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/311",
            "updated_at": "2013-04-17T20:48:21Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/16534726",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2752593?v=3",
                "events_url": "https://api.github.com/users/manufuentescr/events{/privacy}",
                "followers_url": "https://api.github.com/users/manufuentescr/followers",
                "following_url": "https://api.github.com/users/manufuentescr/following{/other_user}",
                "gists_url": "https://api.github.com/users/manufuentescr/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/manufuentescr",
                "id": 2752593,
                "login": "manufuentescr",
                "organizations_url": "https://api.github.com/users/manufuentescr/orgs",
                "received_events_url": "https://api.github.com/users/manufuentescr/received_events",
                "repos_url": "https://api.github.com/users/manufuentescr/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/manufuentescr/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/manufuentescr/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/manufuentescr"
            }
        },
        {
            "body": "Nope, encryption method has been changed for /v2/exist as described here https://github.com/venomous0x/WhatsAPI/issues/283#issuecomment-16417688",
            "created_at": "2013-04-17T21:07:03Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/pull/311#issuecomment-16535756",
            "id": 16535756,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/311",
            "updated_at": "2013-04-17T21:07:03Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/16535756",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1610953?v=3",
                "events_url": "https://api.github.com/users/shirioko/events{/privacy}",
                "followers_url": "https://api.github.com/users/shirioko/followers",
                "following_url": "https://api.github.com/users/shirioko/following{/other_user}",
                "gists_url": "https://api.github.com/users/shirioko/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/shirioko",
                "id": 1610953,
                "login": "shirioko",
                "organizations_url": "https://api.github.com/users/shirioko/orgs",
                "received_events_url": "https://api.github.com/users/shirioko/received_events",
                "repos_url": "https://api.github.com/users/shirioko/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/shirioko/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/shirioko/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/shirioko"
            }
        },
        {
            "body": "I have done the tests,checkCredentials works, with the following steps \r\n\r\n1  change _whatsAppUserAgent to  :\r\n\r\n                    const _whatsAppUserAgent = 'WhatsApp/2.4.7 S40Version/14.26 Device/Nokia302';\r\n\r\n2 change  _whatsAppToken to : \r\n \r\n                   const _whatsAppToken = 'PdA2DJyKoUrwLw1Bg6EIhzh502dF9noR9uFCllGk1359594496554';\r\n\r\n3 change  checkCredentials to : \r\n\r\n     public function checkCredentials()\r\n    {\r\n        if (!$phone = $this->dissectPhone()) {\r\n            throw new Exception('The prived phone number is not valid.');\r\n            return FALSE;\r\n        }\r\n\r\n        // Build the url.\r\n\t\t$this->_identity = $this->encryptIMEI();\r\n\t\t//echo $this->_identity.'\\n \\n';\r\n        $host = 'https://' . WhatsProt::_whatsAppCheHost;\r\n        $query = array(\r\n            'cc' => $phone['cc'],\r\n            'in' => $phone['phone'],\r\n            'id' => $this->_identity,\r\n            \r\n        );\r\n\r\n        $response = $this->getResponse($host, $query);\r\n    \tprint_r($response);\r\n        if ($response->status != 'ok') {\r\n         $this->eventManager()->fire('onBadCredentials', array($this->_phoneNumber, $response->status,       $response->reason));\r\n\t    throw new Exception('There was a problem trying to request the code.');\r\n        } else {\r\n            $this->eventManager()->fire('onGoodCredentials', array(\r\n                $this->_phoneNumber,\r\n                $response->login,\r\n                $response->pw,\r\n                $response->type,\r\n                $response->expiration,\r\n                $response->kind,\r\n                $response->price,\r\n                $response->cost,\r\n                $response->currency,\r\n                $response->price_expiration,\r\n\t\t$response->status\r\n            ));\r\n        }\r\n        return $response;\r\n    } \r\n\r\n\r\n4   add the following function :  \r\n\r\n    public function encryptIMEI()\r\n    {\r\n    \tif(stripos($this->_identity, \":\") !== false){\r\n    \t\t$this->_identity = strtoupper($this->_identity);\r\n    \t\treturn md5($this->_identity.$this->_identity);\r\n    \t}\r\n        else {\r\n        \treturn md5(strrev($this->_identity));\r\n        }\r\n    }\r\n\r\n5   TEST :  \r\n\r\n $userPhone        = '8888888888';       # Telephone number including the country code without '+' or '00'.\r\n$userIdentity     = '00000000'; # This is tipically the IMEI number. \r\n$userName         = 'user';          # This is the username displayed by WhatsApp clients.\r\n$destinationPhone = '888888888';    # Destination telephone number including the country code without '+' or '00'.\r\n$debug = TRUE;\r\n\r\n\r\n$w = new WhatsProt($userPhone, $userIdentity, $userName, $debug);\r\n$w->Connect();\r\n$w->checkCredentials();\r\n\r\n\r\nI hope it works for you !!",
            "created_at": "2013-04-17T21:34:40Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/pull/311#issuecomment-16537283",
            "id": 16537283,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/311",
            "updated_at": "2013-04-17T21:34:40Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/16537283",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2752593?v=3",
                "events_url": "https://api.github.com/users/manufuentescr/events{/privacy}",
                "followers_url": "https://api.github.com/users/manufuentescr/followers",
                "following_url": "https://api.github.com/users/manufuentescr/following{/other_user}",
                "gists_url": "https://api.github.com/users/manufuentescr/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/manufuentescr",
                "id": 2752593,
                "login": "manufuentescr",
                "organizations_url": "https://api.github.com/users/manufuentescr/orgs",
                "received_events_url": "https://api.github.com/users/manufuentescr/received_events",
                "repos_url": "https://api.github.com/users/manufuentescr/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/manufuentescr/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/manufuentescr/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/manufuentescr"
            }
        },
        {
            "body": "Nope. Using the phonenumber and IMEI code of my Android phone with registered whatsapp. Oh well.. I guess it will work if you register by SMS using \r\n\r\n    md5(strrev($imei));\r\n\r\nOne thing that bugs me though. You calculate the hash of your IMEI code in checkCredentials(). But since checkCredentials() can be called multiple times it will re-hash your identity each time you do so. It's more reliable to do this only in __construct() :)",
            "created_at": "2013-04-17T21:52:46Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/pull/311#issuecomment-16538158",
            "id": 16538158,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/311",
            "updated_at": "2013-04-17T21:52:46Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/16538158",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1610953?v=3",
                "events_url": "https://api.github.com/users/shirioko/events{/privacy}",
                "followers_url": "https://api.github.com/users/shirioko/followers",
                "following_url": "https://api.github.com/users/shirioko/following{/other_user}",
                "gists_url": "https://api.github.com/users/shirioko/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/shirioko",
                "id": 1610953,
                "login": "shirioko",
                "organizations_url": "https://api.github.com/users/shirioko/orgs",
                "received_events_url": "https://api.github.com/users/shirioko/received_events",
                "repos_url": "https://api.github.com/users/shirioko/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/shirioko/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/shirioko/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/shirioko"
            }
        },
        {
            "body": "I register the phone numbers with voice and it works.\r\n\r\nI'm still tweaking the code thanks for the suggestion !",
            "created_at": "2013-04-17T22:05:10Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/pull/311#issuecomment-16538751",
            "id": 16538751,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/311",
            "updated_at": "2013-04-17T22:05:10Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/16538751",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2752593?v=3",
                "events_url": "https://api.github.com/users/manufuentescr/events{/privacy}",
                "followers_url": "https://api.github.com/users/manufuentescr/followers",
                "following_url": "https://api.github.com/users/manufuentescr/following{/other_user}",
                "gists_url": "https://api.github.com/users/manufuentescr/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/manufuentescr",
                "id": 2752593,
                "login": "manufuentescr",
                "organizations_url": "https://api.github.com/users/manufuentescr/orgs",
                "received_events_url": "https://api.github.com/users/manufuentescr/received_events",
                "repos_url": "https://api.github.com/users/manufuentescr/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/manufuentescr/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/manufuentescr/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/manufuentescr"
            }
        }
    ],
    "comments": 5,
    "comments_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/311/comments",
    "created_at": "2013-03-27T17:05:40Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1610953?v=3",
                "events_url": "https://api.github.com/users/shirioko/events{/privacy}",
                "followers_url": "https://api.github.com/users/shirioko/followers",
                "following_url": "https://api.github.com/users/shirioko/following{/other_user}",
                "gists_url": "https://api.github.com/users/shirioko/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/shirioko",
                "id": 1610953,
                "login": "shirioko",
                "organizations_url": "https://api.github.com/users/shirioko/orgs",
                "received_events_url": "https://api.github.com/users/shirioko/received_events",
                "repos_url": "https://api.github.com/users/shirioko/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/shirioko/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/shirioko/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/shirioko"
            },
            "commit_id": null,
            "created_at": "2013-06-18T20:41:52Z",
            "event": "closed",
            "id": 53157635,
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/events/53157635"
        }
    ],
    "events_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/311/events",
    "html_url": "https://github.com/venomous0x/WhatsAPI/pull/311",
    "id": 12522222,
    "labels": [],
    "labels_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/311/labels{/name}",
    "locked": false,
    "milestone": null,
    "number": 311,
    "pull_request": {
        "diff_url": "https://github.com/venomous0x/WhatsAPI/pull/311.diff",
        "html_url": "https://github.com/venomous0x/WhatsAPI/pull/311",
        "patch_url": "https://github.com/venomous0x/WhatsAPI/pull/311.patch",
        "url": "https://api.github.com/repos/venomous0x/WhatsAPI/pulls/311"
    },
    "state": "closed",
    "title": "Update checkCredentials()",
    "updated_at": "2013-06-18T20:41:52Z",
    "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/311",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/2752593?v=3",
        "events_url": "https://api.github.com/users/manufuentescr/events{/privacy}",
        "followers_url": "https://api.github.com/users/manufuentescr/followers",
        "following_url": "https://api.github.com/users/manufuentescr/following{/other_user}",
        "gists_url": "https://api.github.com/users/manufuentescr/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/manufuentescr",
        "id": 2752593,
        "login": "manufuentescr",
        "organizations_url": "https://api.github.com/users/manufuentescr/orgs",
        "received_events_url": "https://api.github.com/users/manufuentescr/received_events",
        "repos_url": "https://api.github.com/users/manufuentescr/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/manufuentescr/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/manufuentescr/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/manufuentescr"
    }
}