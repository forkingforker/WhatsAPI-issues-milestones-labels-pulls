{
    "assignee": null,
    "body": "Hey.\n\nSomething's gone wrong with the script now and I'm trying to figure it out. I'm guessing its new Hosts/IP Addresses, because the attempts of reading/writing in the sockets just timesout as follows...\n\n\nphp whatsapp.php -l\n\n\nWarning: socket_read(): unable to read from socket [0]: A connection attempt fai\nled because the connected party did not properly respond after a period of time,\n or established connection failed because connected host has failed to respond.\n in C:\\xampp\\WhatsApp\\src\\php\\whatsprot.class.php on line 125\n\n\nSending messages also does not work, \n\n[] Logging in as 'WhatsAPI Test' (TargetNumber)\n\ntx stream:features\ntx\ntx /stream:features\n\ntx\n\nrx\n\nrx stream:features\nrx\nrx /stream:features\n\n¦!úÅ!Ç«GàƒËýÅ:ietf:params:xml:ns:xmpp-sasl\"> ☼L└P¼\n\ntx Áõ#[û+┴O\nn♠l╝¥A§─¶°ò↨·¢Aû û│↨ â▼░[Q♫,LÖôÂÞ§f\n\nrx Tí³G:╔1ýÃ║ºñíXÂÇQ=\n\ntx\n\ntx\n\n[] Request last seen MyNumberHere:\ntx\ntx\ntx\n\n[] Send message to MyNumberHere: Text Here\n\ntx\ntx\ntx\ntx\ntx\ntx\ntx MyNumberHere\ntx \n\n\nI'll post here if I figure it out, may have been a protocol change too, im unsure.",
    "closed_at": null,
    "comment_data": [
        {
            "body": "same problem as yours, cannot receive any message",
            "created_at": "2012-12-08T09:47:41Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/issues/204#issuecomment-11156960",
            "id": 11156960,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/204",
            "updated_at": "2012-12-08T09:47:41Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/11156960",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2994858?v=3",
                "events_url": "https://api.github.com/users/hohotho/events{/privacy}",
                "followers_url": "https://api.github.com/users/hohotho/followers",
                "following_url": "https://api.github.com/users/hohotho/following{/other_user}",
                "gists_url": "https://api.github.com/users/hohotho/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/hohotho",
                "id": 2994858,
                "login": "hohotho",
                "organizations_url": "https://api.github.com/users/hohotho/orgs",
                "received_events_url": "https://api.github.com/users/hohotho/received_events",
                "repos_url": "https://api.github.com/users/hohotho/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/hohotho/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/hohotho/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/hohotho"
            }
        },
        {
            "body": "Take a look at /src/php/testprotocol.php\r\n\r\nDid you implement a ProcessNode?\r\n\r\n$pn = new ProcessNode($w,$target);\r\n$w->setNewMessageBind($pn);",
            "created_at": "2012-12-08T10:09:11Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/issues/204#issuecomment-11157121",
            "id": 11157121,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/204",
            "updated_at": "2012-12-08T10:09:24Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/11157121",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1610953?v=3",
                "events_url": "https://api.github.com/users/shirioko/events{/privacy}",
                "followers_url": "https://api.github.com/users/shirioko/followers",
                "following_url": "https://api.github.com/users/shirioko/following{/other_user}",
                "gists_url": "https://api.github.com/users/shirioko/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/shirioko",
                "id": 1610953,
                "login": "shirioko",
                "organizations_url": "https://api.github.com/users/shirioko/orgs",
                "received_events_url": "https://api.github.com/users/shirioko/received_events",
                "repos_url": "https://api.github.com/users/shirioko/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/shirioko/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/shirioko/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/shirioko"
            }
        },
        {
            "body": "Sorry, would you mind telling me more how to implement a ProcessNode? Thanks!",
            "created_at": "2012-12-08T10:16:00Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/issues/204#issuecomment-11157169",
            "id": 11157169,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/204",
            "updated_at": "2012-12-08T10:16:00Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/11157169",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2994858?v=3",
                "events_url": "https://api.github.com/users/hohotho/events{/privacy}",
                "followers_url": "https://api.github.com/users/hohotho/followers",
                "following_url": "https://api.github.com/users/hohotho/following{/other_user}",
                "gists_url": "https://api.github.com/users/hohotho/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/hohotho",
                "id": 2994858,
                "login": "hohotho",
                "organizations_url": "https://api.github.com/users/hohotho/orgs",
                "received_events_url": "https://api.github.com/users/hohotho/received_events",
                "repos_url": "https://api.github.com/users/hohotho/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/hohotho/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/hohotho/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/hohotho"
            }
        },
        {
            "body": "It's an object that you assign to your WhatsProt object, and which will be called when a message is received. There's an example in /src/php/testprot.php.\r\n\r\nYou need to copy the class ProcessNode to your own file and modify the process($node) method to your own needs.\r\n\r\n\r\nMy implementation:\r\n\r\nclass ProcessNode{\r\n    function __construct()\r\n    {\r\n    }\r\n    public function process($node)\r\n    {\r\n\t$id = $node->getAttribute(\"id\");\r\n\tif(!checkIfMessageExists($id))\r\n\t{\r\n\t    $raw = mysql_real_escape_string(serialize($node));\r\n\t    $time = $node->getAttribute(\"t\");\r\n\t    $type = $node->getAttribute(\"type\");\r\n\t    $author = $node->getAttribute(\"author\");\r\n\t    $from = $node->getAttribute(\"from\");\r\n\t    if($author == \"\")\r\n\t    {\r\n\t\t//PRIVATE CHAT\r\n\t\t$number = $from;\r\n\t\t$group_id = \"\";\r\n\t    }\r\n\t    else\r\n\t    {\r\n\t\t//GROUP CHAT\r\n\t\t$number = $author;\r\n\t\t$group_id = $from;\r\n\t    }\r\n\t    $number = substr($number, 0, 11);\r\n\t    \r\n\t    $sendername = $node->getChild(\"notify\");\r\n\t    if($sendername != null)\r\n\t\t$sendername = $sendername->getAttribute(\"name\");\r\n\t    else\r\n\t\t$sendername = \"unknown\";\r\n\t    \r\n\t    $body = $node->getChild(\"body\");\r\n\t    if($body != null)\r\n\t\t$body = $body->_data;\r\n\t    else\r\n\t\tcontinue;\r\n\t    \r\n\t    //check if contact exists:\r\n\t    $contact = getContact($number);\r\n\t    if(!$contact)\r\n\t\t$contact = createContact($number, $sendername, \"\");\r\n\t\t\r\n\t    createMessage($id, $_GET['id'], $contact['id'], $time, $body, $type, $raw, $group_id);\r\n\t    //echo \"<b>($sendername):</b><br />$body<br /><br />\";\r\n\t}\r\n    }\r\n}",
            "created_at": "2012-12-08T10:23:07Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/issues/204#issuecomment-11157220",
            "id": 11157220,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/204",
            "updated_at": "2012-12-08T10:23:07Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/11157220",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1610953?v=3",
                "events_url": "https://api.github.com/users/shirioko/events{/privacy}",
                "followers_url": "https://api.github.com/users/shirioko/followers",
                "following_url": "https://api.github.com/users/shirioko/following{/other_user}",
                "gists_url": "https://api.github.com/users/shirioko/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/shirioko",
                "id": 1610953,
                "login": "shirioko",
                "organizations_url": "https://api.github.com/users/shirioko/orgs",
                "received_events_url": "https://api.github.com/users/shirioko/received_events",
                "repos_url": "https://api.github.com/users/shirioko/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/shirioko/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/shirioko/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/shirioko"
            }
        }
    ],
    "comments": 4,
    "comments_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/204/comments",
    "created_at": "2012-12-01T18:50:55Z",
    "event_data": [],
    "events_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/204/events",
    "html_url": "https://github.com/venomous0x/WhatsAPI/issues/204",
    "id": 8900468,
    "labels": [],
    "labels_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/204/labels{/name}",
    "locked": false,
    "milestone": null,
    "number": 204,
    "state": "open",
    "title": "Send Msg / Listen / Convo",
    "updated_at": "2012-12-08T10:23:07Z",
    "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/204",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/2939964?v=3",
        "events_url": "https://api.github.com/users/z0rax/events{/privacy}",
        "followers_url": "https://api.github.com/users/z0rax/followers",
        "following_url": "https://api.github.com/users/z0rax/following{/other_user}",
        "gists_url": "https://api.github.com/users/z0rax/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/z0rax",
        "id": 2939964,
        "login": "z0rax",
        "organizations_url": "https://api.github.com/users/z0rax/orgs",
        "received_events_url": "https://api.github.com/users/z0rax/received_events",
        "repos_url": "https://api.github.com/users/z0rax/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/z0rax/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/z0rax/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/z0rax"
    }
}