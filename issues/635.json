{
    "assignee": null,
    "body": "WhatsApp stores the \"password\" in an encrypted 'pw' file within the Android Sanbox.\r\nIt also stores the 'id' parameter that allows re-registration without SMS verification in \"Exteranal Storage/WhatsApp/Profile Pictures/.nomedia\"\r\n```\r\nThe following Python code can decode both files:\r\nfrom pbkdf2 import PBKDF2\r\nfrom Crypto.Cipher import AES\r\nimport base64\r\nimport time\r\nimport javaobj\r\nimport re\r\n\r\nsauce1 = '\\xc2\\x99\\x1e\\xc2\\x9b\\x1d\\x0c\\xc2\\xb8\\xc3\\xb7UdX\\xc2\\x98\\xc2\\x92\\x03\\xc2\\x8bE\\xc2\\x97>x\\xc3\\x86\\xc3\\x95'\r\nsauce2 = 'S\\x16\\x0fR\\x03\\nD\\xc2\\x83\\x10\\xc2\\x82\\xc2\\x9a\\xc2\\x8d\\xc2\\x8cF:!i)WA'\r\n\r\ndef do_decode(special_sauce, jabber_id, pw_file_content):\r\n    salt = pw_file_content[2:6]\r\n    iv = pw_file_content[6:22]\r\n    encrypted_key = pw_file_content[22:]\r\n    file_enc_key = PBKDF2(special_sauce + jabber_id, salt, 16).read(16)\r\n    crypt = AES.new(file_enc_key, AES.MODE_OFB, iv)\r\n    return crypt.decrypt(encrypted_key + '1'*12)[:20]\r\n\r\ndef decode_pw(mefname, pwfname):\r\n    jabber_id = javaobj.JavaObjectUnmarshaller(open(mefname)).readObject().jabber_id\r\n    pw = javaobj.JavaObjectUnmarshaller(open(pwfname)).readObject()\r\n    pw_file_content = \"\".join([chr(c) if c>=0 else chr(c+256) for c in pw])\r\n    wa_key = do_decode(sauce1, jabber_id, pw_file_content)\r\n    return base64.b64encode(wa_key)\r\n\r\nC = re.compile(\"^([17]|2[07]|3[0123469]|4[013456789]|5[12345678]|6[0123456]|8[1246]|9[0123458]|\\d{3})\\d*?(\\d{4,6})$\")\r\n\r\ndef decode_nomedia(nomedia, pn, account):\r\n    g = C.match(pn)\r\n    e = g.group(1) + g.group(2)\r\n    jabberid = e + account\r\n    pw = javaobj.JavaObjectUnmarshaller(open(nomedia)).readObject()\r\n    pw_file_content = \"\".join([chr(c) if c>=0 else chr(c+256) for c in pw])\r\n    return do_decode(sauce2, jabberid, pw_file_content)\r\n\r\nprint \"%r\" % (decode_nomedia(\".nomedia\", \"12125551234\", \"your.google.account@gmail.com\"),)\r\n```",
    "closed_at": null,
    "comment_data": [
        {
            "body": "Damn it, gave it a shot last night but couldn't figure out how to deserialize Java objects in C# or even PHP >.<\r\n\r\nI'll have to either port the javaobj library to C# or use IKVM to embed Java's deserializer into a DLL, neither of which I'm looking forward to :')",
            "created_at": "2014-03-19T10:03:43Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/issues/635#issuecomment-38033908",
            "id": 38033908,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/635",
            "updated_at": "2014-03-19T10:03:43Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/38033908",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1610953?v=3",
                "events_url": "https://api.github.com/users/shirioko/events{/privacy}",
                "followers_url": "https://api.github.com/users/shirioko/followers",
                "following_url": "https://api.github.com/users/shirioko/following{/other_user}",
                "gists_url": "https://api.github.com/users/shirioko/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/shirioko",
                "id": 1610953,
                "login": "shirioko",
                "organizations_url": "https://api.github.com/users/shirioko/orgs",
                "received_events_url": "https://api.github.com/users/shirioko/received_events",
                "repos_url": "https://api.github.com/users/shirioko/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/shirioko/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/shirioko/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/shirioko"
            }
        },
        {
            "body": "You don't need full Java serialization - just enough to deserialize a couple of files.\r\nFrom the Python code (and looking at https://code.google.com/p/python-javaobj), it seems you only need to deserialize an array object (or a string?).\r\nAnyway - just follow the Python deserializer and see how to decode _these_ files - no need for something generic.\r\nI think you should see 0x75 somewhere around the start to indicate what follows is an array. 0x74 if it's encoded as a string.\r\nDon't have an Android myself so can't check...",
            "created_at": "2014-03-19T13:01:00Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/issues/635#issuecomment-38047324",
            "id": 38047324,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/635",
            "updated_at": "2014-03-19T13:01:00Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/38047324",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/6998582?v=3",
                "events_url": "https://api.github.com/users/johnstern/events{/privacy}",
                "followers_url": "https://api.github.com/users/johnstern/followers",
                "following_url": "https://api.github.com/users/johnstern/following{/other_user}",
                "gists_url": "https://api.github.com/users/johnstern/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/johnstern",
                "id": 6998582,
                "login": "johnstern",
                "organizations_url": "https://api.github.com/users/johnstern/orgs",
                "received_events_url": "https://api.github.com/users/johnstern/received_events",
                "repos_url": "https://api.github.com/users/johnstern/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/johnstern/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/johnstern/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/johnstern"
            }
        },
        {
            "body": "from the funny looking line:\r\n```pw_file_content = \"\".join([chr(c) if c>=0 else chr(c+256) for c in pw])```\r\nI think this is a byte array (Java bytes are signed)\r\n\r\n",
            "created_at": "2014-03-19T13:03:39Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/issues/635#issuecomment-38047557",
            "id": 38047557,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/635",
            "updated_at": "2014-03-19T13:03:39Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/38047557",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/6998582?v=3",
                "events_url": "https://api.github.com/users/johnstern/events{/privacy}",
                "followers_url": "https://api.github.com/users/johnstern/followers",
                "following_url": "https://api.github.com/users/johnstern/following{/other_user}",
                "gists_url": "https://api.github.com/users/johnstern/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/johnstern",
                "id": 6998582,
                "login": "johnstern",
                "organizations_url": "https://api.github.com/users/johnstern/orgs",
                "received_events_url": "https://api.github.com/users/johnstern/received_events",
                "repos_url": "https://api.github.com/users/johnstern/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/johnstern/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/johnstern/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/johnstern"
            }
        },
        {
            "body": "Here's a documentation of Java serialization:\r\nhttp://www.public.iastate.edu/~java/docs/guide/serialization/protocol.doc.html\r\n",
            "created_at": "2014-03-19T13:18:49Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/issues/635#issuecomment-38048973",
            "id": 38048973,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/635",
            "updated_at": "2014-03-19T13:18:49Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/38048973",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/6998582?v=3",
                "events_url": "https://api.github.com/users/johnstern/events{/privacy}",
                "followers_url": "https://api.github.com/users/johnstern/followers",
                "following_url": "https://api.github.com/users/johnstern/following{/other_user}",
                "gists_url": "https://api.github.com/users/johnstern/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/johnstern",
                "id": 6998582,
                "login": "johnstern",
                "organizations_url": "https://api.github.com/users/johnstern/orgs",
                "received_events_url": "https://api.github.com/users/johnstern/received_events",
                "repos_url": "https://api.github.com/users/johnstern/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/johnstern/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/johnstern/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/johnstern"
            }
        },
        {
            "body": "Nice, thanks :)\r\nGot the deserialization to work in C#, data arrays seem to have constant length of 42 byte, now for the decryptor...",
            "created_at": "2014-03-19T15:37:08Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/issues/635#issuecomment-38065572",
            "id": 38065572,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/635",
            "updated_at": "2014-03-19T15:37:08Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/38065572",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1610953?v=3",
                "events_url": "https://api.github.com/users/shirioko/events{/privacy}",
                "followers_url": "https://api.github.com/users/shirioko/followers",
                "following_url": "https://api.github.com/users/shirioko/following{/other_user}",
                "gists_url": "https://api.github.com/users/shirioko/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/shirioko",
                "id": 1610953,
                "login": "shirioko",
                "organizations_url": "https://api.github.com/users/shirioko/orgs",
                "received_events_url": "https://api.github.com/users/shirioko/received_events",
                "repos_url": "https://api.github.com/users/shirioko/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/shirioko/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/shirioko/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/shirioko"
            }
        },
        {
            "body": "So, does this actually work?",
            "created_at": "2014-03-20T09:38:16Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/issues/635#issuecomment-38148572",
            "id": 38148572,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/635",
            "updated_at": "2014-03-20T09:38:16Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/38148572",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/6998582?v=3",
                "events_url": "https://api.github.com/users/johnstern/events{/privacy}",
                "followers_url": "https://api.github.com/users/johnstern/followers",
                "following_url": "https://api.github.com/users/johnstern/following{/other_user}",
                "gists_url": "https://api.github.com/users/johnstern/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/johnstern",
                "id": 6998582,
                "login": "johnstern",
                "organizations_url": "https://api.github.com/users/johnstern/orgs",
                "received_events_url": "https://api.github.com/users/johnstern/received_events",
                "repos_url": "https://api.github.com/users/johnstern/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/johnstern/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/johnstern/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/johnstern"
            }
        },
        {
            "body": ".NET doesnt support OFB mode for AEs >.< I'll give it a try using PHP tonight\r\nAs for parsing the files: you can get the stored data from \"pw\" and \".nomedia\" simply by reading the last 42 byte of the files :') the rest of it is just metadata\r\n```php\r\n$data = file_get_contents(\"pw\");\r\n$data = substr($data, strlen($data) - 42, 42);\r\n```",
            "created_at": "2014-03-20T09:42:23Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/issues/635#issuecomment-38148899",
            "id": 38148899,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/635",
            "updated_at": "2014-03-20T09:43:13Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/38148899",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1610953?v=3",
                "events_url": "https://api.github.com/users/shirioko/events{/privacy}",
                "followers_url": "https://api.github.com/users/shirioko/followers",
                "following_url": "https://api.github.com/users/shirioko/following{/other_user}",
                "gists_url": "https://api.github.com/users/shirioko/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/shirioko",
                "id": 1610953,
                "login": "shirioko",
                "organizations_url": "https://api.github.com/users/shirioko/orgs",
                "received_events_url": "https://api.github.com/users/shirioko/received_events",
                "repos_url": "https://api.github.com/users/shirioko/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/shirioko/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/shirioko/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/shirioko"
            }
        },
        {
            "body": "That's easy...\r\nAs for OFB: implementing it shouldn't be a problem if you have AES in ECB mode (i.e. encrypt each block separately) - especially since it seems you only need to encrypt 20 bytes (2 blocks), although it seems .NET knows about OFB mode: http://msdn.microsoft.com/en-us/library/system.security.cryptography.ciphermode%28v=vs.110%29.aspx\r\n\r\npseudo code for OFB mode on 2 blocks is something like:\r\n```\r\naes_ofb(key, iv, data) {\r\n    //  iv is 16 bytes, data is less than 32\r\n   crypt[0 .. 15]   = aes(key, iv)  // encrypt iv using the key\r\n   crypt[16 .. 32] = aes(key, crypt[0 .. 15]) // encrypt the result of the previous block using the same key\r\n\r\n   // now all we need to do is xor the crypt with data. something like:\r\n   for i in 0..size(data) {\r\n      res = data[i] ^ crypt[i]\r\n   }\r\n   return res\r\n}\r\n```\r\nSee also https://en.wikipedia.org/wiki/Block_cipher_mode_of_operation#Output_feedback_.28OFB.29\r\n\r\n",
            "created_at": "2014-03-20T10:18:30Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/issues/635#issuecomment-38151695",
            "id": 38151695,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/635",
            "updated_at": "2014-03-20T10:21:34Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/38151695",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/6998582?v=3",
                "events_url": "https://api.github.com/users/johnstern/events{/privacy}",
                "followers_url": "https://api.github.com/users/johnstern/followers",
                "following_url": "https://api.github.com/users/johnstern/following{/other_user}",
                "gists_url": "https://api.github.com/users/johnstern/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/johnstern",
                "id": 6998582,
                "login": "johnstern",
                "organizations_url": "https://api.github.com/users/johnstern/orgs",
                "received_events_url": "https://api.github.com/users/johnstern/received_events",
                "repos_url": "https://api.github.com/users/johnstern/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/johnstern/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/johnstern/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/johnstern"
            }
        },
        {
            "body": "also, note that according to https://en.wikipedia.org/wiki/PBKDF2, PBKDF2 takes MAC and hash function as inputs.\r\nI _think_ this is the module used in the python code: https://github.com/dlitz/python-pbkdf2. If so, the defaults seem to be HMAC & SHA1.",
            "created_at": "2014-03-20T10:42:45Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/issues/635#issuecomment-38153348",
            "id": 38153348,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/635",
            "updated_at": "2014-03-20T10:42:45Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/38153348",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/6998582?v=3",
                "events_url": "https://api.github.com/users/johnstern/events{/privacy}",
                "followers_url": "https://api.github.com/users/johnstern/followers",
                "following_url": "https://api.github.com/users/johnstern/following{/other_user}",
                "gists_url": "https://api.github.com/users/johnstern/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/johnstern",
                "id": 6998582,
                "login": "johnstern",
                "organizations_url": "https://api.github.com/users/johnstern/orgs",
                "received_events_url": "https://api.github.com/users/johnstern/received_events",
                "repos_url": "https://api.github.com/users/johnstern/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/johnstern/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/johnstern/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/johnstern"
            }
        }
    ],
    "comments": 9,
    "comments_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/635/comments",
    "created_at": "2014-03-18T21:04:31Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1610953?v=3",
                "events_url": "https://api.github.com/users/shirioko/events{/privacy}",
                "followers_url": "https://api.github.com/users/shirioko/followers",
                "following_url": "https://api.github.com/users/shirioko/following{/other_user}",
                "gists_url": "https://api.github.com/users/shirioko/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/shirioko",
                "id": 1610953,
                "login": "shirioko",
                "organizations_url": "https://api.github.com/users/shirioko/orgs",
                "received_events_url": "https://api.github.com/users/shirioko/received_events",
                "repos_url": "https://api.github.com/users/shirioko/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/shirioko/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/shirioko/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/shirioko"
            },
            "commit_id": null,
            "created_at": "2014-03-28T11:03:09Z",
            "event": "labeled",
            "id": 106418420,
            "label": {
                "color": "84b6eb",
                "name": "enhancement"
            },
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/events/106418420"
        }
    ],
    "events_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/635/events",
    "html_url": "https://github.com/venomous0x/WhatsAPI/issues/635",
    "id": 29684678,
    "labels": [
        {
            "color": "84b6eb",
            "name": "enhancement",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/labels/enhancement"
        }
    ],
    "labels_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/635/labels{/name}",
    "locked": false,
    "milestone": null,
    "number": 635,
    "state": "open",
    "title": "Extracting the WhatsApp passowrd on Android",
    "updated_at": "2014-03-28T11:03:09Z",
    "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/635",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/6991650?v=3",
        "events_url": "https://api.github.com/users/whatsappnomedia/events{/privacy}",
        "followers_url": "https://api.github.com/users/whatsappnomedia/followers",
        "following_url": "https://api.github.com/users/whatsappnomedia/following{/other_user}",
        "gists_url": "https://api.github.com/users/whatsappnomedia/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/whatsappnomedia",
        "id": 6991650,
        "login": "whatsappnomedia",
        "organizations_url": "https://api.github.com/users/whatsappnomedia/orgs",
        "received_events_url": "https://api.github.com/users/whatsappnomedia/received_events",
        "repos_url": "https://api.github.com/users/whatsappnomedia/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/whatsappnomedia/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/whatsappnomedia/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/whatsappnomedia"
    }
}