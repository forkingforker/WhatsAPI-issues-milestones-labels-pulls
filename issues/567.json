{
    "assignee": null,
    "body": "as poss read all received messages (of any type: chat, video, audio, etc.) and store them in a database table? the thing that I can not do is receive messages ... the second part is ready (code speaking)",
    "closed_at": null,
    "comment_data": [
        {
            "body": "call $w->pollMessages() in a while loop.",
            "created_at": "2014-01-05T16:15:53Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/issues/567#issuecomment-31607849",
            "id": 31607849,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/567",
            "updated_at": "2014-01-05T16:15:53Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/31607849",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1610953?v=3",
                "events_url": "https://api.github.com/users/shirioko/events{/privacy}",
                "followers_url": "https://api.github.com/users/shirioko/followers",
                "following_url": "https://api.github.com/users/shirioko/following{/other_user}",
                "gists_url": "https://api.github.com/users/shirioko/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/shirioko",
                "id": 1610953,
                "login": "shirioko",
                "organizations_url": "https://api.github.com/users/shirioko/orgs",
                "received_events_url": "https://api.github.com/users/shirioko/received_events",
                "repos_url": "https://api.github.com/users/shirioko/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/shirioko/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/shirioko/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/shirioko"
            }
        },
        {
            "body": "I also recomeend to take a look at the test files https://github.com/venomous0x/WhatsAPI/blob/master/tests/whatsapp.php",
            "created_at": "2014-01-05T16:22:53Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/issues/567#issuecomment-31608009",
            "id": 31608009,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/567",
            "updated_at": "2014-01-05T16:22:53Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/31608009",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/604766?v=3",
                "events_url": "https://api.github.com/users/DurtyFree/events{/privacy}",
                "followers_url": "https://api.github.com/users/DurtyFree/followers",
                "following_url": "https://api.github.com/users/DurtyFree/following{/other_user}",
                "gists_url": "https://api.github.com/users/DurtyFree/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/DurtyFree",
                "id": 604766,
                "login": "DurtyFree",
                "organizations_url": "https://api.github.com/users/DurtyFree/orgs",
                "received_events_url": "https://api.github.com/users/DurtyFree/received_events",
                "repos_url": "https://api.github.com/users/DurtyFree/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/DurtyFree/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/DurtyFree/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/DurtyFree"
            }
        },
        {
            "body": "I've already tried ... just as soon as I start from only the last message sent .. and if by chance they do not send other shows! .. : (",
            "created_at": "2014-01-05T16:37:44Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/issues/567#issuecomment-31608417",
            "id": 31608417,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/567",
            "updated_at": "2014-01-05T16:37:44Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/31608417",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/630722?v=3",
                "events_url": "https://api.github.com/users/enzolarosa/events{/privacy}",
                "followers_url": "https://api.github.com/users/enzolarosa/followers",
                "following_url": "https://api.github.com/users/enzolarosa/following{/other_user}",
                "gists_url": "https://api.github.com/users/enzolarosa/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/enzolarosa",
                "id": 630722,
                "login": "enzolarosa",
                "organizations_url": "https://api.github.com/users/enzolarosa/orgs",
                "received_events_url": "https://api.github.com/users/enzolarosa/received_events",
                "repos_url": "https://api.github.com/users/enzolarosa/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/enzolarosa/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/enzolarosa/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/enzolarosa"
            }
        },
        {
            "body": "Maybe you give us your code so we'll be able to help you out.",
            "created_at": "2014-01-05T23:00:54Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/issues/567#issuecomment-31618575",
            "id": 31618575,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/567",
            "updated_at": "2014-01-05T23:00:54Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/31618575",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/604766?v=3",
                "events_url": "https://api.github.com/users/DurtyFree/events{/privacy}",
                "followers_url": "https://api.github.com/users/DurtyFree/followers",
                "following_url": "https://api.github.com/users/DurtyFree/following{/other_user}",
                "gists_url": "https://api.github.com/users/DurtyFree/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/DurtyFree",
                "id": 604766,
                "login": "DurtyFree",
                "organizations_url": "https://api.github.com/users/DurtyFree/orgs",
                "received_events_url": "https://api.github.com/users/DurtyFree/received_events",
                "repos_url": "https://api.github.com/users/DurtyFree/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/DurtyFree/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/DurtyFree/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/DurtyFree"
            }
        },
        {
            "body": "Can you post your debug output when logging in, I think your login is failing.",
            "created_at": "2014-01-06T09:51:43Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/issues/567#issuecomment-31637212",
            "id": 31637212,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/567",
            "updated_at": "2014-01-06T09:51:43Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/31637212",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1610953?v=3",
                "events_url": "https://api.github.com/users/shirioko/events{/privacy}",
                "followers_url": "https://api.github.com/users/shirioko/followers",
                "following_url": "https://api.github.com/users/shirioko/following{/other_user}",
                "gists_url": "https://api.github.com/users/shirioko/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/shirioko",
                "id": 1610953,
                "login": "shirioko",
                "organizations_url": "https://api.github.com/users/shirioko/orgs",
                "received_events_url": "https://api.github.com/users/shirioko/received_events",
                "repos_url": "https://api.github.com/users/shirioko/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/shirioko/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/shirioko/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/shirioko"
            }
        },
        {
            "body": "I'm using this code to receive messages\r\n\r\n\r\nThis is the link where you can see his behavior \r\n```php\r\n<?php\r\nsession_start();\r\nset_time_limit(100);\r\ndate_default_timezone_set('Europe/Rome');\r\ninclude 'err.php';\r\nrequire_once 'php/whatsprot.class.php';\r\nrequire_once 'php/contacts.php';\r\n\r\n$debug = true;\r\n\r\n$username = \"MY_NUMBER\";\r\n$identity = \"MY_IDENTITY\";\r\n$password = \"MY__PASSWORD\";\r\n$nickname = \"MY_NICK\";\r\n\r\nfunction onMessage($mynumber, $from, $id, $type, $time, $name, $body){   \r\n    \r\n    echo \"Messaggio da <b>$name</b> - (from $from - id $id - type $type - time $time ) :\\n$body\\n\\n <br />\";\r\n}\r\n\r\n$host=\"localhost\";\r\n$pass=\"pD4uba3xVny1Uc\";\r\n$db=\"c1_whatsapp\";\r\n\r\n\r\n\r\nfunction running($time){\r\n\tsession_start();    \r\n    $running = $_SESSION[\"running\"];\r\n    if ($running != $time) {\r\n        die();\r\n    }\r\n    session_write_close();\r\n    return true;\r\n}\r\n\r\n\r\n\r\n$w = new WhatsProt($username, $identity, $nickname, $debug);\r\n$w->eventManager()->bind(\"onGetMessage\", \"onMessage\");\r\n$w->Connect();\r\n$w->LoginWithPassword($password);\r\n\r\n$time = $_SESSION[\"running\"];\r\nwhile (running($time)) {\r\n    $w->pollMessages();\r\n    running($time); \r\n    \r\n    $messages = $w->getMessages();\r\n    if (count($messages) > 0) {\r\n        //session_start();\r\n        //$inbound = $_SESSION[\"inbound\"];\r\n        //$_SESSION[\"inbound\"] = array(); //lock\r\n        foreach ($messages as $message) {\r\n            $data = @$message->getChild(\"body\")->getData();\r\n            if ($data != null && $data != '') {\r\n                //$inbound[] = $data;\r\n                print_r($data);\r\n                echo \"-123123123-<br />\";\r\n            }\r\n        }\r\n        //$_SESSION[\"inbound\"] = $inbound;\r\n       // session_write_close();\r\n    }\r\n}\r\n```\r\nhttp://www.lrweb.it/progetti/WHATSAPP/receiver.php\r\n\r\n(I have debugging enabled)",
            "created_at": "2014-01-06T21:53:19Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/issues/567#issuecomment-31691277",
            "id": 31691277,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/567",
            "updated_at": "2014-01-09T08:51:14Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/31691277",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/630722?v=3",
                "events_url": "https://api.github.com/users/enzolarosa/events{/privacy}",
                "followers_url": "https://api.github.com/users/enzolarosa/followers",
                "following_url": "https://api.github.com/users/enzolarosa/following{/other_user}",
                "gists_url": "https://api.github.com/users/enzolarosa/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/enzolarosa",
                "id": 630722,
                "login": "enzolarosa",
                "organizations_url": "https://api.github.com/users/enzolarosa/orgs",
                "received_events_url": "https://api.github.com/users/enzolarosa/received_events",
                "repos_url": "https://api.github.com/users/enzolarosa/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/enzolarosa/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/enzolarosa/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/enzolarosa"
            }
        },
        {
            "body": "No I'm talking about the debug output when running the script. You should get a \\<success> or \\<failure> node when trying to log in.",
            "created_at": "2014-01-09T08:52:46Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/issues/567#issuecomment-31912566",
            "id": 31912566,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/567",
            "updated_at": "2014-01-09T08:52:46Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/31912566",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1610953?v=3",
                "events_url": "https://api.github.com/users/shirioko/events{/privacy}",
                "followers_url": "https://api.github.com/users/shirioko/followers",
                "following_url": "https://api.github.com/users/shirioko/following{/other_user}",
                "gists_url": "https://api.github.com/users/shirioko/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/shirioko",
                "id": 1610953,
                "login": "shirioko",
                "organizations_url": "https://api.github.com/users/shirioko/orgs",
                "received_events_url": "https://api.github.com/users/shirioko/received_events",
                "repos_url": "https://api.github.com/users/shirioko/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/shirioko/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/shirioko/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/shirioko"
            }
        },
        {
            "body": "I modified a bit the code now is as follows\r\n\r\nstatic.php\r\n```php\r\n<?php\r\n/*STATIC FILE*/\r\n//session_start();\r\nset_time_limit(100);\r\ndate_default_timezone_set('Europe/Rome');\r\ninclude 'err.php';\r\nrequire_once 'php/whatsprot.class.php';\r\nrequire_once 'php/contacts.php';\r\n\r\n$debug = true;\r\n\r\n$username = \"393421659721\";\r\n$identity = \"MY_ID\";\r\n$password = \"MY_PASS\";\r\n$nickname = \"LRWeb\";\r\n\r\nfunction onMessage($mynumber, $from, $id, $type, $time, $name, $body){     \r\n    echo \"Messaggio da <b>$name</b> - (from $from - id $id - type $type - time $time ) :\\n$body\\n\\n <br />\";\r\n}\r\n\r\n$host=\"localhost\";\r\n$pass=\"MY_PASS\";\r\n$db=\"MY_DB\";\r\n/*\r\nfunction running($time){\r\n\tsession_start();    \r\n    $running = $_SESSION[\"running\"];\r\n    if ($running != $time) {\r\n        die();\r\n    }\r\n    session_write_close();\r\n    return true;\r\n}\r\n*/\r\n?>\r\n```\r\n\r\nreceiver.php\r\n```php\r\n\r\n<?php\r\ninclude 'static.php';\r\n\r\n$w = new WhatsProt($username, $identity, $nickname, $debug);\r\n$w->eventManager()->bind(\"onGetMessage\", \"onMessage\");\r\n$w->Connect();\r\n$w->LoginWithPassword($password);\r\n\r\nwhile (TRUE) {\r\n    $w->pollMessages();\r\n    $messages = $w->getMessages();\r\n    if (count($messages) > 0) {\r\n        foreach ($messages as $message) {\r\n            $data = @$message->getChild(\"body\")->getData();\r\n            if ($data != null && $data != '') {\r\n                print_r($data);\r\n                echo \"-123123123-<br />\";\r\n            }\r\n        }\r\n    }\r\n    die; //to block everything out and see what the outcome\r\n}\r\n\r\n```\r\n\r\nthe result that I get from\r\n\r\n```xml\r\ntx  <stream:features>\r\ntx    <receipt_acks></receipt_acks>\r\ntx    <status></status>\r\ntx  </stream:features>\r\n\r\ntx  <auth xmlns=\"urn:ietf:params:xml:ns:xmpp-sasl\" mechanism=\"WAUTH-1\" user=\"393421659721\">��\"\u000fy�HM��)m--�����P\u001bB��k���&P�\u0016��a��\u0002�\u0001���]ij�&\b��-�?�\u0011�Ae����a,�R�?��/\u0011�߇��e���\u0017E\u0011���\u0010���%n����0?!DGs8</auth>\r\n\r\nrx  <start from=\"s.whatsapp.net\"></start>\r\n\r\nrx  <stream:features>\r\nrx    <receipt_acks></receipt_acks>\r\nrx    <w:profile:picture type=\"all\"></w:profile:picture>\r\nrx  </stream:features>\r\n\r\nrx  <success t=\"1389265110\" xmlns=\"urn:ietf:params:xml:ns:xmpp-sasl\" kind=\"free\" status=\"active\" creation=\"1388846391\" expiration=\"1420382391\">8ggz|�\u0001\u001f��ޅ�\u0005\\��^�\t</success>\r\n\r\nrx  <ib from=\"s.whatsapp.net\">\r\nrx    <offline count=\"0\"></offline>\r\nrx  </ib>\r\n\r\ntx  <presence type=\"available\" name=\"LRWeb\"></presence>\r\n\r\nrx  <presence from=\"393421659721@s.whatsapp.net\" type=\"available\"></presence>\r\n```\r\n\r\nAnother small problem as I can receive voice messages, or messages with images or video using the same code? .. so I do a cron job on the server every X seconds and goes to read the new messages and stores them in the database",
            "created_at": "2014-01-09T10:59:52Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/issues/567#issuecomment-31920448",
            "id": 31920448,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/567",
            "updated_at": "2014-01-09T13:22:11Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/31920448",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/630722?v=3",
                "events_url": "https://api.github.com/users/enzolarosa/events{/privacy}",
                "followers_url": "https://api.github.com/users/enzolarosa/followers",
                "following_url": "https://api.github.com/users/enzolarosa/following{/other_user}",
                "gists_url": "https://api.github.com/users/enzolarosa/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/enzolarosa",
                "id": 630722,
                "login": "enzolarosa",
                "organizations_url": "https://api.github.com/users/enzolarosa/orgs",
                "received_events_url": "https://api.github.com/users/enzolarosa/received_events",
                "repos_url": "https://api.github.com/users/enzolarosa/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/enzolarosa/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/enzolarosa/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/enzolarosa"
            }
        },
        {
            "body": "If you click on the link you see it immediately github if not well taken http://www.lrweb.it/progetti/WHATSAPP/receiver.php",
            "created_at": "2014-01-09T11:00:54Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/issues/567#issuecomment-31920540",
            "id": 31920540,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/567",
            "updated_at": "2014-01-09T11:00:54Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/31920540",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/630722?v=3",
                "events_url": "https://api.github.com/users/enzolarosa/events{/privacy}",
                "followers_url": "https://api.github.com/users/enzolarosa/followers",
                "following_url": "https://api.github.com/users/enzolarosa/following{/other_user}",
                "gists_url": "https://api.github.com/users/enzolarosa/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/enzolarosa",
                "id": 630722,
                "login": "enzolarosa",
                "organizations_url": "https://api.github.com/users/enzolarosa/orgs",
                "received_events_url": "https://api.github.com/users/enzolarosa/received_events",
                "repos_url": "https://api.github.com/users/enzolarosa/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/enzolarosa/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/enzolarosa/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/enzolarosa"
            }
        }
    ],
    "comments": 9,
    "comments_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/567/comments",
    "created_at": "2014-01-05T14:55:00Z",
    "event_data": [],
    "events_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/567/events",
    "html_url": "https://github.com/venomous0x/WhatsAPI/issues/567",
    "id": 25071924,
    "labels": [],
    "labels_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/567/labels{/name}",
    "locked": false,
    "milestone": null,
    "number": 567,
    "state": "open",
    "title": "Inbox in the database",
    "updated_at": "2014-01-09T13:22:11Z",
    "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/567",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/630722?v=3",
        "events_url": "https://api.github.com/users/enzolarosa/events{/privacy}",
        "followers_url": "https://api.github.com/users/enzolarosa/followers",
        "following_url": "https://api.github.com/users/enzolarosa/following{/other_user}",
        "gists_url": "https://api.github.com/users/enzolarosa/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/enzolarosa",
        "id": 630722,
        "login": "enzolarosa",
        "organizations_url": "https://api.github.com/users/enzolarosa/orgs",
        "received_events_url": "https://api.github.com/users/enzolarosa/received_events",
        "repos_url": "https://api.github.com/users/enzolarosa/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/enzolarosa/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/enzolarosa/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/enzolarosa"
    }
}