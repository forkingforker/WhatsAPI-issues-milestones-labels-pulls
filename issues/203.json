{
    "assignee": null,
    "body": "I'm able to login using my android phone's credentials, but when i try to send a message to my friend whose using an iPhone, he is not receiving any messages.\n\nMy code : \n\n#!/usr/bin/php\n<?php\nrequire \"../src/php/whatsprot.class.php\";\nfunction fgets_u($pStdn) {\n\t$pArr = array($pStdn);\n\n\tif (false === ($num_changed_streams = stream_select($pArr, $write = NULL, $except = NULL, 0))) {\n\t\tprint(\"\\$ 001 Socket Error : UNABLE TO WATCH STDIN.\\n\");\n\t\treturn FALSE;\n\t} elseif ($num_changed_streams > 0) {\n\t\treturn trim(fgets($pStdn, 1024));\n\t}\n}\n\n\n$nickname = \"WhatsAPI Test\";\n$sender = \t\"91974*******\"; // Mobile number with country code (but without + or 00)\n$imei = \t\"My IMEI number here\"; // MAC Address for iOS IMEI for other platform (Android/etc)\n\n$countrycode = substr($sender, 0, 2);\n$phonenumber=substr($sender, 2);\necho \"[] Logging in as '$nickname' ($sender)\\n\";\n$wa = new WhatsProt($sender, $imei, $nickname, true);\n\n$url = \"https://r.whatsapp.net/v1/exist.php?cc=\".$countrycode.\"&in=\".$phonenumber.\"&udid=\".$wa->encryptPassword();\n$content = file_get_contents($url);\nif(stristr($content,'status=\"ok\"') === false){\n\techo \"Wrong Password\\n\";\n\texit(0);\n}\n$wa->Connect();\n$wa->Login();\n\n$dst = \"9199********\";\n$msg = \"Whatsup bro\";\necho \"\\n[] Send message to $dst: $msg\\n\";\n$wa->Message(time().\"-1\", $dst , $msg); \n\nThe output i see is....\n\n#!/usr/bin/php [] Logging in as 'WhatsAPI Test' (91974*******1) tx tx tx tx rx rx rx rx rx û° ¿m.a¦x¦m9T½è`º,tg tx a\u0015®÷3g‹È±K¨\u0006è\u000bLÓ\u0003”™Ã}»Ñõzuð \bZŒ´‰­·\u001eÝ©â?ÊGÊKa rx MW\u000bùõ“ìnZO’m¿2¾sÙfO$ tx tx [] Send message to 9199********: Whatsup bro tx tx tx tx tx tx tx 9199******** tx",
    "closed_at": null,
    "comment_data": [
        {
            "body": "I believe WhatsApp crew did some changes. Try doing\r\n\r\nphp whatsapp.php -l\r\n\r\nShould be giving you a timeout error (socket_read()) as of the latest version of this script source. My guess is they changed their network configs, such as IPs, and possibly port, which is why we can't grab any data when trying to listen or send messages.\r\n\r\nThis is what I get when I do\r\n\r\nphp whatsapp.php -s MyNumberHere \"Text Here\"\r\n\r\n=====================================\r\n\r\n# php whatsapp.php -s MyNumberGere \"Text Here\"\r\n[] Logging in as 'WhatsAPI Test' (TargetNumber)\r\n\r\ntx  <stream:features>\r\ntx    <receipt_acks></receipt_acks>\r\ntx  </stream:features>\r\n\r\ntx  <auth xmlns=\"urn:ietf:params:xml:ns:xmpp-sasl\" mechanism=\"WAUTH-1\" user=\"TargetNumber\"></auth>\r\n\r\nrx  <start from=\"s.whatsapp.net\"></start>\r\n\r\nrx  <stream:features>\r\nrx    <receipt_acks></receipt_acks>\r\nrx  </stream:features>\r\n\r\n¦!úÅ!Ç«GàƒËýÅ</challenge>:ietf:params:xml:ns:xmpp-sasl\">        ☼L└P¼\r\n\r\ntx  <response xmlns=\"urn:ietf:params:xml:ns:xmpp-sasl\">Áõ#[û+┴O\r\nn♠l╝¥A§─¶°ò↨·¢Aû û│↨ â▼░[Q♫,LÖôÂÞ§f\r\n</response>\r\n\r\nrx  <success xmlns=\"urn:ietf:params:xml:ns:xmpp-sasl\" status=\"active\" kind=\"free\r\n\" creation=\"1325849451\" expiration=\"1357344651\">Tí³G:╔1ýÃ║ºñíXÂÇQ=</success>\r\n\r\ntx  <presence name=\"WhatsAPI Test\"></presence>\r\n\r\ntx  <presence type=\"available\" name=\"WhatsAPI Test\"></presence>\r\n\r\n[] Request last seen MyNumberHere:\r\ntx  <iq to=\"MyNumberHere@s.whatsapp.net\" type=\"get\" id=\"1354386938-1\" from=\"TargetAndroidPhone@s.whatsapp.net\">\r\ntx    <query xmlns=\"jabber:iq:last\"></query>\r\ntx  </iq>\r\n\r\n[] Send message to MyNumberHere: Text Here\r\n\r\ntx  <message to=\"1354386938-1@s.whatsapp.net\" type=\"chat\" id=\"1354386938-1\" t=\"1\r\n354386938\">\r\ntx    <x xmlns=\"jabber:x:event\">\r\ntx      <server></server>\r\ntx    </x>\r\ntx    <notify xmlns=\"urn:xmpp:whatsapp\" name=\"WhatsAPI Test\"></notify>\r\ntx    <request xmlns=\"urn:xmpp:receipts\"></request>\r\ntx    <body>MyNumberHere</body>\r\ntx  </message>\r\n\r\n\r\nAnd no messages ever get sent to my phone. My guess is the configs are wrong in the current version of this script.",
            "created_at": "2012-12-01T18:22:58Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/issues/203#issuecomment-10920196",
            "id": 10920196,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/203",
            "updated_at": "2012-12-01T18:22:58Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/10920196",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2939964?v=3",
                "events_url": "https://api.github.com/users/z0rax/events{/privacy}",
                "followers_url": "https://api.github.com/users/z0rax/followers",
                "following_url": "https://api.github.com/users/z0rax/following{/other_user}",
                "gists_url": "https://api.github.com/users/z0rax/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/z0rax",
                "id": 2939964,
                "login": "z0rax",
                "organizations_url": "https://api.github.com/users/z0rax/orgs",
                "received_events_url": "https://api.github.com/users/z0rax/received_events",
                "repos_url": "https://api.github.com/users/z0rax/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/z0rax/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/z0rax/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/z0rax"
            }
        },
        {
            "body": "No, i don't think the IP addresses and Port were changed because i'm still able to change my status successfully, the only issue seems to be with the receiving and sending of messages. They must've changed their encryption protocol or something.",
            "created_at": "2012-12-02T04:55:56Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/issues/203#issuecomment-10926168",
            "id": 10926168,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/203",
            "updated_at": "2012-12-02T04:55:56Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/10926168",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10137?v=3",
                "events_url": "https://api.github.com/users/ghost/events{/privacy}",
                "followers_url": "https://api.github.com/users/ghost/followers",
                "following_url": "https://api.github.com/users/ghost/following{/other_user}",
                "gists_url": "https://api.github.com/users/ghost/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/ghost",
                "id": 10137,
                "login": "ghost",
                "organizations_url": "https://api.github.com/users/ghost/orgs",
                "received_events_url": "https://api.github.com/users/ghost/received_events",
                "repos_url": "https://api.github.com/users/ghost/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/ghost/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ghost/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/ghost"
            }
        },
        {
            "body": "Then what about listening mode ? Unable to read and/or write with the sockets....\r\nBut yeah, looks like protocol.",
            "created_at": "2012-12-02T10:07:22Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/issues/203#issuecomment-10927972",
            "id": 10927972,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/203",
            "updated_at": "2012-12-02T10:07:22Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/10927972",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2939964?v=3",
                "events_url": "https://api.github.com/users/z0rax/events{/privacy}",
                "followers_url": "https://api.github.com/users/z0rax/followers",
                "following_url": "https://api.github.com/users/z0rax/following{/other_user}",
                "gists_url": "https://api.github.com/users/z0rax/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/z0rax",
                "id": 2939964,
                "login": "z0rax",
                "organizations_url": "https://api.github.com/users/z0rax/orgs",
                "received_events_url": "https://api.github.com/users/z0rax/received_events",
                "repos_url": "https://api.github.com/users/z0rax/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/z0rax/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/z0rax/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/z0rax"
            }
        },
        {
            "body": "I started using\r\n\r\n$wa->Message( target, \"text\")\r\ninstead of\r\n$wa->Message( time() . \"-1\", target, \"text\")\r\nand it works sometimes. Need to refresh the php document a few times sometimes but it does work, for now.",
            "created_at": "2012-12-02T14:05:56Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/issues/203#issuecomment-10929957",
            "id": 10929957,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/203",
            "updated_at": "2012-12-02T14:05:56Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/10929957",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2939964?v=3",
                "events_url": "https://api.github.com/users/z0rax/events{/privacy}",
                "followers_url": "https://api.github.com/users/z0rax/followers",
                "following_url": "https://api.github.com/users/z0rax/following{/other_user}",
                "gists_url": "https://api.github.com/users/z0rax/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/z0rax",
                "id": 2939964,
                "login": "z0rax",
                "organizations_url": "https://api.github.com/users/z0rax/orgs",
                "received_events_url": "https://api.github.com/users/z0rax/received_events",
                "repos_url": "https://api.github.com/users/z0rax/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/z0rax/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/z0rax/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/z0rax"
            }
        },
        {
            "body": "I did not check out the listening mode. I wrote my own code looking at the example. \r\nIn my code the message function is already modified. So it's fine. Something else seems to be going wrong :(",
            "created_at": "2012-12-05T02:48:34Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/issues/203#issuecomment-11026063",
            "id": 11026063,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/203",
            "updated_at": "2012-12-05T02:48:34Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/11026063",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10137?v=3",
                "events_url": "https://api.github.com/users/ghost/events{/privacy}",
                "followers_url": "https://api.github.com/users/ghost/followers",
                "following_url": "https://api.github.com/users/ghost/following{/other_user}",
                "gists_url": "https://api.github.com/users/ghost/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/ghost",
                "id": 10137,
                "login": "ghost",
                "organizations_url": "https://api.github.com/users/ghost/orgs",
                "received_events_url": "https://api.github.com/users/ghost/received_events",
                "repos_url": "https://api.github.com/users/ghost/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/ghost/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ghost/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/ghost"
            }
        },
        {
            "body": "A few days ago the $wa->Message( target, \"text\"); was working properly (Removing the time(). \"-1\", part). Now, it just displays the message as a notification on your phone, but does not actually send a message to the target. It just displays the notification.\r\n\r\nSeems like to me the protocol is just going worse and worse..",
            "created_at": "2012-12-05T06:23:05Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/issues/203#issuecomment-11031034",
            "id": 11031034,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/203",
            "updated_at": "2012-12-05T06:23:05Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/11031034",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2939964?v=3",
                "events_url": "https://api.github.com/users/z0rax/events{/privacy}",
                "followers_url": "https://api.github.com/users/z0rax/followers",
                "following_url": "https://api.github.com/users/z0rax/following{/other_user}",
                "gists_url": "https://api.github.com/users/z0rax/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/z0rax",
                "id": 2939964,
                "login": "z0rax",
                "organizations_url": "https://api.github.com/users/z0rax/orgs",
                "received_events_url": "https://api.github.com/users/z0rax/received_events",
                "repos_url": "https://api.github.com/users/z0rax/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/z0rax/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/z0rax/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/z0rax"
            }
        },
        {
            "body": "password method is changed ,so if your mobile is updated with new version of whatsapp,msgs wont go",
            "created_at": "2012-12-09T20:34:53Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/issues/203#issuecomment-11175574",
            "id": 11175574,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/203",
            "updated_at": "2012-12-09T20:34:53Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/11175574",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2313436?v=3",
                "events_url": "https://api.github.com/users/brittson/events{/privacy}",
                "followers_url": "https://api.github.com/users/brittson/followers",
                "following_url": "https://api.github.com/users/brittson/following{/other_user}",
                "gists_url": "https://api.github.com/users/brittson/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/brittson",
                "id": 2313436,
                "login": "brittson",
                "organizations_url": "https://api.github.com/users/brittson/orgs",
                "received_events_url": "https://api.github.com/users/brittson/received_events",
                "repos_url": "https://api.github.com/users/brittson/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/brittson/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/brittson/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/brittson"
            }
        }
    ],
    "comments": 7,
    "comments_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/203/comments",
    "created_at": "2012-12-01T15:47:09Z",
    "event_data": [],
    "events_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/203/events",
    "html_url": "https://github.com/venomous0x/WhatsAPI/issues/203",
    "id": 8896922,
    "labels": [],
    "labels_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/203/labels{/name}",
    "locked": false,
    "milestone": null,
    "number": 203,
    "state": "open",
    "title": "Not able to send messages",
    "updated_at": "2012-12-09T20:34:53Z",
    "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/203",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/10137?v=3",
        "events_url": "https://api.github.com/users/ghost/events{/privacy}",
        "followers_url": "https://api.github.com/users/ghost/followers",
        "following_url": "https://api.github.com/users/ghost/following{/other_user}",
        "gists_url": "https://api.github.com/users/ghost/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/ghost",
        "id": 10137,
        "login": "ghost",
        "organizations_url": "https://api.github.com/users/ghost/orgs",
        "received_events_url": "https://api.github.com/users/ghost/received_events",
        "repos_url": "https://api.github.com/users/ghost/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/ghost/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/ghost/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/ghost"
    }
}