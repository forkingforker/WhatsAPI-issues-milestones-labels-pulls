{
    "assignee": null,
    "body": "Here capture from debugging output : \r\n\r\n```\r\nrx  <message from=\"6017396xxxx-1374248895@g.us\" id=\"1388863615-253\" type=\"chat\" t=\"1388866804\" author=\"6017464xxxx@s.whatsapp.net\">\r\nrx    <notify xmlns=\"urn:xmpp:whatsapp\" name=\"johnxagerεëÅ\"></notify>\r\nrx    <request xmlns=\"urn:xmpp:receipts\"></request>\r\nrx    <body>removed content</body>\r\nrx    <urn:xmpp:whatsapp:dirty></urn:xmpp:whatsapp:dirty>\r\nrx  </message>\r\n```\r\n\r\nor \r\n\r\n```\r\nrx  <message from=\"6017396xxxx-1374248895@g.us\" id=\"1388863615-253\" type=\"chat\" t=\"1388866804\" author=\"6017464xxxx@s.whatsapp.net\">\r\nrx    <notify xmlns=\"urn:xmpp:whatsapp\" name=\"johnxagerεëÅ\"></notify>\r\nrx    <request xmlns=\"urn:xmpp:receipts\"></request>\r\nrx    <body>removed content</body>\r\nrx    <message_acks =\"\"></message_acks>\r\nrx  </message>\r\n```\r\n\r\nDescription : When I received message with above example, my script stop working immediately. There are several output such as : \r\n\r\n```\r\nrx     <iq =\"\"></iq>\r\n\r\nrx    <microsoft></microsoft>\r\n\r\nrx    <remote-server-timeout =\"\"></remote-server-timeout>\r\n```\r\n\r\nalso appear when I running my script (When it happen, I need to restart my script). \r\n\r\nAny link can I refer?\r\n\r\n",
    "closed_at": null,
    "comment_data": [
        {
            "body": "Post your script.",
            "created_at": "2014-01-04T20:36:40Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/issues/566#issuecomment-31587980",
            "id": 31587980,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/566",
            "updated_at": "2014-01-04T20:36:40Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/31587980",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1610953?v=3",
                "events_url": "https://api.github.com/users/shirioko/events{/privacy}",
                "followers_url": "https://api.github.com/users/shirioko/followers",
                "following_url": "https://api.github.com/users/shirioko/following{/other_user}",
                "gists_url": "https://api.github.com/users/shirioko/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/shirioko",
                "id": 1610953,
                "login": "shirioko",
                "organizations_url": "https://api.github.com/users/shirioko/orgs",
                "received_events_url": "https://api.github.com/users/shirioko/received_events",
                "repos_url": "https://api.github.com/users/shirioko/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/shirioko/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/shirioko/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/shirioko"
            }
        },
        {
            "body": "Listen Mode : \r\n\r\n```\r\nif ($_SERVER['argv'][1] == \"-l\") {\r\n\techo \"\\n[] Listen mode:\\n\";\r\n\twhile (TRUE) {\r\n\t\t$wa->PollMessages();\r\n\t\t$data = $wa->GetMessages();\r\n\t\t\r\n\t\tforeach ($data as $m)\r\n\t\t{\r\n\t\t\t$content = $m->NodeString(\"\");\r\n\t\t\t\r\n\t\t\t$newstr = preg_replace('/[^a-z0-9\\<\\>\\\"\\=\\ \\n\\-\\.\\:\\!\\@\\#\\?\\/]/i', '', $content);\r\n\t\t\t$newstr1 = preg_replace('/(<media[^>]*>)(.*?)(<\\/media>)/is','$1w$3',$newstr);\r\n\t\t\t$strfix = preg_replace_callback('@\\<body(.*?)\\>(.*?)\\<\\/body\\>@mis','_handle_match', $newstr1);\r\n\t\t\t$strfix1 = preg_replace_callback('@\\<offline(.*?)\\>(.*?)\\<\\/offline\\>@mis','_handle_match_offline', $strfix);\r\n\t\t\t$strfix_last = preg_replace_callback('@\\<notify xmlns=\"urn:xmpp:whatsapp\" name=\"(.*?)\\/notify\\>@mis','_handle_match_nick', $strfix1);\r\n\t\t\t\r\n\t\t\t$xml = new SimpleXMLElement($strfix_last);\t\t\t\r\n\t\t\t$msgid = $xml->attributes()->id;\r\n\t\t\t$author = $xml->attributes()->author;\t\t\t\r\n\t\t\t$msgtext = $xml->body;\r\n\t\t\t$msgtype = $xml->attributes()->type;\r\n\t\t\t$group = $xml->attributes()->from;\r\n\t\t\t$requesttype = $xml->media;\r\n\t\t\t$x_id = $xml->x->id;\r\n\t\t\t$is_offline = $xml->offline;\r\n\t\t\t\r\n\t\t\tif (!empty($msgid) && !empty($msgtext) && !empty($group) && $msgtype = 'chat' && $requesttype != \"w\" && empty($is_offline)) {\t\t\t\t\r\n\t\t\t\t$receivename = $xml->notify->attributes()->name;\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t$file = 'blacklist.txt';\r\n\t\t\t\t$searchfor = substr($author,0,-15);\r\n\t\t\t\t\r\n\t\t\t\t$contents = file_get_contents($file);\r\n\t\t\t\t$pattern = preg_quote($searchfor, '/');\r\n\t\t\t\t$pattern = \"/^.*$pattern.*\\$/m\";\r\n\t\t\t\tif(preg_match_all($pattern, $contents, $matches)){\r\n\t\t\t\t   //do nothing\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\t$thelink1 = \"http://192.168.1.111/whatsoos/groupchat/starter.php?msgid=\" . $msgid . \"&phone=\" . substr($author,0,-15)  . \"&message=\" . urlencode($msgtext) . \"&groupid=\" . urlencode($group) . \"&name=\" . urlencode($receivename);\r\n\t\t\t\t\t\r\n\t\t\t\t\t// Get cURL resource\r\n\t\t\t\t\t$curl = curl_init();\r\n\t\t\t\t\t// Set some options - we are passing in a useragent too here\r\n\t\t\t\t\tcurl_setopt_array($curl, array(\r\n\t\t\t\t\t\tCURLOPT_RETURNTRANSFER => 1,\r\n\t\t\t\t\t\tCURLOPT_URL => $thelink1,\r\n\t\t\t\t\t\tCURLOPT_USERAGENT => 'WhatsApp_GW'\r\n\t\t\t\t\t));\r\n\t\t\t\t\t// Send the request & save response to $resp\r\n\t\t\t\t\t$resp = curl_exec($curl);\r\n\t\t\t\t\t// Close request to clear up some resources\r\n\t\t\t\t\tcurl_close($curl);\r\n\t\t\t\t\t\r\n\t\t\t\t\t$xml_setting = GetSettings($group);\r\n\t\t\t\t\t\r\n\t\t\t\t\t$array = explode(\"|\", $xml_setting);\r\n\t\t\t\t\t$active = $array[0];\r\n\t\t\t\t\t$timer = $array[1];\r\n\t\t\t\t\t$question = $array[2];\r\n\t\t\t\t\t$answer = $array[3];\r\n\t\t\t\t\t$issend = $array[4];\r\n\t\t\t\t\t$restart = $array[5];\r\n\t\t\t\t\t$loopf = $array[6];\r\n\t\t\t\t\t$blindsend = $array[7];\r\n\t\t\t\t\t$bonustime = $array[8];\r\n\t\t\t\t\t$nowsendit = $array[9];\r\n\t\t\t\t\t$forcesend = $array[10];\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (!empty($resp) && strpos($group,'-') && empty($nowsendit) || $forcesend == '1') {\r\n\t\t\t\t\t\t$wa->sendMessage($group, $resp);\r\n\r\n\t\t\t\t\t\t$msgtoprint = \"** Sending ID : \" . $msgid . \" -> From : \" . substr($author,0,-15) . \" -> Group : \" . $group . \" -> Message : [\" . $resp . \"]\";\r\n\t\t\t\t\t\tsleep(1);\t\t\t\t\t\t\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else if (!empty($msgid) && !empty($group) && $msgtype = 'chat' && !empty($x_id) && strpos($group,'-')) {\t\t\t\r\n\t\t\t\t// receive notification\r\n\t\t\t\tif (trim($msgid) == trim($x_id)) {\r\n\t\t\t\t\tWriteXML($group, \"nowsendit\", \"\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} // End Foreach <----------------\r\n\t\t\r\n\t\t$thelink2 = \"http://192.168.1.111/whatsoos/groupchat/looper.php\";\r\n\t\t\t\r\n\t\t$curl2 = curl_init();\r\n\t\tcurl_setopt_array($curl2, array(\r\n\t\t\tCURLOPT_RETURNTRANSFER => 1,\r\n\t\t\tCURLOPT_URL => $thelink2,\r\n\t\t\tCURLOPT_USERAGENT => 'WhatsApp_GW'\r\n\t\t));\r\n\t\t$resp2 = curl_exec($curl2);\r\n\t\tcurl_close($curl2);\r\n\t\t\r\n\t\tif (!empty($resp2)) {\r\n\t\t\techo \"\\n\".date(\"d/m/Y h:i:s a\", time()).\" -> ENTER ---> \".$resp2.\"\\n\";\r\n\t\t\tif (substr($resp2,0,11) == \"leave_group\") {\r\n\t\t\t\t$array = explode(\"|\", $resp2);\r\n\t\t\t\t$thecountsum = count($array);\r\n\t\t\t\tif ($thecountsum >= 1) {\r\n\t\t\t\t\t$wa->SendEndGroupChat($array[1]);\r\n\t\t\t\t\t$wa->SendLeaveGroups($array[1]);\r\n\t\t\t\t\techo \"\\nLeaving Group : \" . $array[1] . \"\\n\";\r\n\t\t\t\t}\r\n\t\t\t} else if (substr($resp2,0,14) == \"get_group_user\") {\r\n\t\t\t\t$array = explode(\"|\", $resp2);\r\n\t\t\t\t$thecountsum = count($array);\r\n\t\t\t\tif ($thecountsum >= 1) {\r\n\t\t\t\t\t$wa->eventManager()->bind(\"onGetGroupParticipant\", \"onGroupParticipant\");\r\n\t\t\t\t\t$wa->SendGetParticipants($array[1]);\r\n\t\t\t\t\techo \"\\nGet Group Participant : \" . $array[1] . \"\\n\";\r\n\t\t\t\t}\r\n\t\t\t} else if (substr($resp2,0,14) == \"get_group_list\") {\r\n\t\t\t\t$array = explode(\"|\", $resp2);\r\n\t\t\t\t$thecountsum = count($array);\r\n\t\t\t\tif ($thecountsum >= 1) {\r\n\t\t\t\t\t$wa->eventManager()->bind(\"onGetGroupList\", \"onGroupList\");\r\n\t\t\t\t\t$wa->SendGetGroups();\r\n\t\t\t\t\techo \"\\nGet Listing Group Now!!\\n\";\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t$array = explode(\"|\", $resp2);\t\t\t\t\r\n\t\t\t\t$thecountsum = intval(count($array) / 2);\r\n\t\t\t\t\r\n\t\t\t\tif ($thecountsum >= 1) {\r\n\t\t\t\t\t$i = 0;\r\n\t\t\t\t\tdo {\t\t\t\t\r\n\t\t\t\t\t\t$group_glo = $array[$i + $i];\r\n\t\t\t\t\t\t$returnTxt1 = $array[($i + $i) + 1];\r\n\t\t\t\t\t\t$returnTxt1 = trim($returnTxt1);\r\n\t\t\t\t\t\tif (!empty($group_glo) && !empty($returnTxt1) && strpos($group_glo,'-') && strpos($group_glo,'g.us')) {\r\n\t\t\t\t\t\t\t$xml_setting = GetSettings($group_glo);\r\n\t\t\t\t\t\t\t$array = explode(\"|\", $xml_setting);\r\n\t\t\t\t\t\t\t$active = $array[0];\r\n\t\t\t\t\t\t\t$timer = $array[1];\r\n\t\t\t\t\t\t\t$question = $array[2];\r\n\t\t\t\t\t\t\t$answer = $array[3];\r\n\t\t\t\t\t\t\t$issend = $array[4];\r\n\t\t\t\t\t\t\t$restart = $array[5];\r\n\t\t\t\t\t\t\t$loopf = $array[6];\r\n\t\t\t\t\t\t\t$blindsend = $array[7];\r\n\t\t\t\t\t\t\t$bonustime = $array[8];\r\n\t\t\t\t\t\t\t$nowsendit = $array[9];\r\n\t\t\t\t\t\t\t$forcesend = $array[10];\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif (empty($nowsendit) && strpos($group_glo,'-') || $forcesend == '1') {\r\n\t\t\t\t\t\t\t\t$wa->sendMessage($group_glo, $returnTxt1);\t\t\t\t\t\t\r\n\t\t\r\n\t\t\t\t\t\t\t\t$msgtoprint = \"** Sending to Group : \" . $group_glo . \" -> Message : [\" . $returnTxt1 . \"]\";\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tWriteXML($group_glo, \"nowsendit\", \"1\");\r\n\t\t\t\t\t\t\t\tWriteXML($group_glo, \"forcesend\", \"\");\r\n\t\t\t\t\t\t\t\tsleep(1);\r\n\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t++$i;\r\n\t\t\t\t\t} while ($i < $thecountsum);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\t\t\r\n\t\tsleep(3);\r\n\t}\r\n\texit(0);\r\n}\r\n```",
            "created_at": "2014-01-04T20:52:00Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/issues/566#issuecomment-31588306",
            "id": 31588306,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/566",
            "updated_at": "2014-01-04T20:52:00Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/31588306",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/343826?v=3",
                "events_url": "https://api.github.com/users/mofbar/events{/privacy}",
                "followers_url": "https://api.github.com/users/mofbar/followers",
                "following_url": "https://api.github.com/users/mofbar/following{/other_user}",
                "gists_url": "https://api.github.com/users/mofbar/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/mofbar",
                "id": 343826,
                "login": "mofbar",
                "organizations_url": "https://api.github.com/users/mofbar/orgs",
                "received_events_url": "https://api.github.com/users/mofbar/received_events",
                "repos_url": "https://api.github.com/users/mofbar/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/mofbar/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mofbar/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/mofbar"
            }
        },
        {
            "body": "That's quite a script. Why not use an event handler?",
            "created_at": "2014-01-06T09:53:12Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/issues/566#issuecomment-31637278",
            "id": 31637278,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/566",
            "updated_at": "2014-01-06T09:53:12Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/31637278",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1610953?v=3",
                "events_url": "https://api.github.com/users/shirioko/events{/privacy}",
                "followers_url": "https://api.github.com/users/shirioko/followers",
                "following_url": "https://api.github.com/users/shirioko/following{/other_user}",
                "gists_url": "https://api.github.com/users/shirioko/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/shirioko",
                "id": 1610953,
                "login": "shirioko",
                "organizations_url": "https://api.github.com/users/shirioko/orgs",
                "received_events_url": "https://api.github.com/users/shirioko/received_events",
                "repos_url": "https://api.github.com/users/shirioko/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/shirioko/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/shirioko/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/shirioko"
            }
        }
    ],
    "comments": 3,
    "comments_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/566/comments",
    "created_at": "2014-01-04T20:30:09Z",
    "event_data": [],
    "events_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/566/events",
    "html_url": "https://github.com/venomous0x/WhatsAPI/issues/566",
    "id": 25059585,
    "labels": [],
    "labels_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/566/labels{/name}",
    "locked": false,
    "milestone": null,
    "number": 566,
    "state": "open",
    "title": "WhatsAPI Stop / Stuck",
    "updated_at": "2014-01-06T09:53:12Z",
    "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/566",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/343826?v=3",
        "events_url": "https://api.github.com/users/mofbar/events{/privacy}",
        "followers_url": "https://api.github.com/users/mofbar/followers",
        "following_url": "https://api.github.com/users/mofbar/following{/other_user}",
        "gists_url": "https://api.github.com/users/mofbar/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/mofbar",
        "id": 343826,
        "login": "mofbar",
        "organizations_url": "https://api.github.com/users/mofbar/orgs",
        "received_events_url": "https://api.github.com/users/mofbar/received_events",
        "repos_url": "https://api.github.com/users/mofbar/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/mofbar/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/mofbar/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/mofbar"
    }
}