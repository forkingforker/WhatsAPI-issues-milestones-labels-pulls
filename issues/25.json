{
    "assignee": null,
    "body": "why is login took time so long, then I fugured out with some debug log read twice/three times on login, last one took like 2 minutes. \n\nget some reply like this, and I put str2hex , I dont know what it means.\n\n\n [Custom] process k:0 v: H8�C1344924219-ping�:�\u0001�\u0003q�� str2hex 20f80848388a43fc0f313334343932343231392d70696e67a23af801f80371bdac\n\n",
    "closed_at": "2012-08-15T19:42:59Z",
    "comment_data": [
        {
            "body": "I have the same Problem in the PHP Version with my Login. After 30 Seconds the limit is exceeded. Also removing UTF-8 from  the auth function is not working.",
            "created_at": "2012-08-14T12:06:31Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/issues/25#issuecomment-7723755",
            "id": 7723755,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/25",
            "updated_at": "2012-08-14T12:06:31Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/7723755",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1257443?v=3",
                "events_url": "https://api.github.com/users/stvnwrgs/events{/privacy}",
                "followers_url": "https://api.github.com/users/stvnwrgs/followers",
                "following_url": "https://api.github.com/users/stvnwrgs/following{/other_user}",
                "gists_url": "https://api.github.com/users/stvnwrgs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/stvnwrgs",
                "id": 1257443,
                "login": "stvnwrgs",
                "organizations_url": "https://api.github.com/users/stvnwrgs/orgs",
                "received_events_url": "https://api.github.com/users/stvnwrgs/received_events",
                "repos_url": "https://api.github.com/users/stvnwrgs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/stvnwrgs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/stvnwrgs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/stvnwrgs"
            }
        },
        {
            "body": "so any log whats happening in background, I use android version of whatsapp when register.\nI see login is successfull, but after it cause long delay,\n\n\n352308622 -> account_info <h3> account_info </h3>Array\n(\n    [status] => active\n    [kind] => free\n    [creation] => 1305220622\n    [expiration] => 1352308622\n)\n\nafter sending this command : end next ?t??a?\nAhmed Mohd?HC?:??{?M??Ua$HC?2?:??????\n\nand long delay is wait for read sock command.\n\nhow about you ?",
            "created_at": "2012-08-14T12:17:05Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/issues/25#issuecomment-7723959",
            "id": 7723959,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/25",
            "updated_at": "2012-08-14T12:17:05Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/7723959",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/551532?v=3",
                "events_url": "https://api.github.com/users/assegaf/events{/privacy}",
                "followers_url": "https://api.github.com/users/assegaf/followers",
                "following_url": "https://api.github.com/users/assegaf/following{/other_user}",
                "gists_url": "https://api.github.com/users/assegaf/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/assegaf",
                "id": 551532,
                "login": "assegaf",
                "organizations_url": "https://api.github.com/users/assegaf/orgs",
                "received_events_url": "https://api.github.com/users/assegaf/received_events",
                "repos_url": "https://api.github.com/users/assegaf/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/assegaf/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/assegaf/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/assegaf"
            }
        },
        {
            "body": "The issue is that the login code as is had areas with 2 reads in a row, they are just blindly reading from the socket, but there might not be any data on that socket (for example all of the data may have been read on the first read), and when that happens the socket blocks. I agree this area should be improved.",
            "created_at": "2012-08-14T19:02:38Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/issues/25#issuecomment-7736474",
            "id": 7736474,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/25",
            "updated_at": "2012-08-14T19:02:38Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/7736474",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1149188?v=3",
                "events_url": "https://api.github.com/users/cdesjardins/events{/privacy}",
                "followers_url": "https://api.github.com/users/cdesjardins/followers",
                "following_url": "https://api.github.com/users/cdesjardins/following{/other_user}",
                "gists_url": "https://api.github.com/users/cdesjardins/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/cdesjardins",
                "id": 1149188,
                "login": "cdesjardins",
                "organizations_url": "https://api.github.com/users/cdesjardins/orgs",
                "received_events_url": "https://api.github.com/users/cdesjardins/received_events",
                "repos_url": "https://api.github.com/users/cdesjardins/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/cdesjardins/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/cdesjardins/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/cdesjardins"
            }
        },
        {
            "body": "thanks  cdesjardins , I see this last command  cause long delay\n\n$next = \"\\x00\\x12\\xf8\\x05\\x74\\xa2\\xa3\\x61\\xfc\\x0a\\x41\\x68\\x6d\\x65\\x64\\x20\\x4d\\x6f\\x68\\x64\\x00\\x15\\xf8\\x06\\x48\\x43\\x05\\xa2\\x3a\\xf8\\x01\\xf8\\x04\\x7b\\xbd\\x4d\\xf8\\x01\\xf8\\x03\\x55\\x61\\x24\\x00\\x12\\xf8\\x08\\x48\\x43\\xfc\\x01\\x32\\xa2\\x3a\\xa0\\x8a\\xf8\\x01\\xf8\\x03\\x1f\\xbd\\xb1\";\n$stream = $this->send($next);\n$this->read(); // LONG DELAY is this Command \n\n\nI dont know what is that command in hex used to ? any idea ?",
            "created_at": "2012-08-15T04:32:21Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/issues/25#issuecomment-7747845",
            "id": 7747845,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/25",
            "updated_at": "2012-08-15T04:32:21Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/7747845",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/551532?v=3",
                "events_url": "https://api.github.com/users/assegaf/events{/privacy}",
                "followers_url": "https://api.github.com/users/assegaf/followers",
                "following_url": "https://api.github.com/users/assegaf/following{/other_user}",
                "gists_url": "https://api.github.com/users/assegaf/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/assegaf",
                "id": 551532,
                "login": "assegaf",
                "organizations_url": "https://api.github.com/users/assegaf/orgs",
                "received_events_url": "https://api.github.com/users/assegaf/received_events",
                "repos_url": "https://api.github.com/users/assegaf/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/assegaf/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/assegaf/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/assegaf"
            }
        },
        {
            "body": "dear cdesjardins, I see now your explanation, there is 2 read in a row means, when I remove one, looks like delay gone.\nWhen I remove thoose line, so last line in Login() method is :$rBuffer =$this->read();\n\nbut when I send msg $wa->Message(time().\"-1\",\"62214421XXXX\",\"test message\");\nI got \n\n\t�t8��+��\u0001\n\n]8��\u0006Server�C�15567�\u001b�\n1345005817�\u0001�\u0002\u0016��New version of WhatsApp Messenger is now available. Please visit http://www.whatsapp.com/appstore/ and upgrade to the latest version. Your upgrade will be free and will bring bug fixes and new features such as Group Icons! \n\nat first read, I dont know, I tought its Android, why is appstore ?\n\n",
            "created_at": "2012-08-15T04:49:01Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/issues/25#issuecomment-7748009",
            "id": 7748009,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/25",
            "updated_at": "2012-08-15T04:49:01Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/7748009",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/551532?v=3",
                "events_url": "https://api.github.com/users/assegaf/events{/privacy}",
                "followers_url": "https://api.github.com/users/assegaf/followers",
                "following_url": "https://api.github.com/users/assegaf/following{/other_user}",
                "gists_url": "https://api.github.com/users/assegaf/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/assegaf",
                "id": 551532,
                "login": "assegaf",
                "organizations_url": "https://api.github.com/users/assegaf/orgs",
                "received_events_url": "https://api.github.com/users/assegaf/received_events",
                "repos_url": "https://api.github.com/users/assegaf/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/assegaf/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/assegaf/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/assegaf"
            }
        },
        {
            "body": "The reason it redirects you to the app store is because the php code logs in to WhatsApp as an iPhone-2.6.9. Furthermore be aware that just removing one of those reads might not always work either. This area of the code is not really well done... Typically this type of thing is done with a \"read\" thread that pulls data off the wire and queues it locally for the main thread to manipulate. In this case you would want to check the local queue for the expected responses, and if they do not arrive after some short but reasonable timeout then an error should be produced... But of course that is a big pain in the neck...",
            "created_at": "2012-08-15T09:30:10Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/issues/25#issuecomment-7751899",
            "id": 7751899,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/25",
            "updated_at": "2012-08-15T09:30:10Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/7751899",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1149188?v=3",
                "events_url": "https://api.github.com/users/cdesjardins/events{/privacy}",
                "followers_url": "https://api.github.com/users/cdesjardins/followers",
                "following_url": "https://api.github.com/users/cdesjardins/following{/other_user}",
                "gists_url": "https://api.github.com/users/cdesjardins/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/cdesjardins",
                "id": 1149188,
                "login": "cdesjardins",
                "organizations_url": "https://api.github.com/users/cdesjardins/orgs",
                "received_events_url": "https://api.github.com/users/cdesjardins/received_events",
                "repos_url": "https://api.github.com/users/cdesjardins/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/cdesjardins/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/cdesjardins/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/cdesjardins"
            }
        },
        {
            "body": "ok I see when \"read\" thread that pulls data  (wait so long), I send message to that whatsapp account, they indeed receive data and print it as \"message\", which means receive message working. but I dont know how send work, I ve changed the \niPhone-2.6.9 to Android-2.34-5222 which has the same length string, \n\nI see this code messed up, maybe I want to port it to java socket programming, maybe if I have time.",
            "created_at": "2012-08-15T09:42:17Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/issues/25#issuecomment-7752127",
            "id": 7752127,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/25",
            "updated_at": "2012-08-15T09:42:17Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/7752127",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/551532?v=3",
                "events_url": "https://api.github.com/users/assegaf/events{/privacy}",
                "followers_url": "https://api.github.com/users/assegaf/followers",
                "following_url": "https://api.github.com/users/assegaf/following{/other_user}",
                "gists_url": "https://api.github.com/users/assegaf/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/assegaf",
                "id": 551532,
                "login": "assegaf",
                "organizations_url": "https://api.github.com/users/assegaf/orgs",
                "received_events_url": "https://api.github.com/users/assegaf/received_events",
                "repos_url": "https://api.github.com/users/assegaf/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/assegaf/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/assegaf/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/assegaf"
            }
        },
        {
            "body": "You can change iPhone-2.6.9-5222 to iPhone-2.8.2-5222.",
            "created_at": "2012-08-15T12:32:15Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/issues/25#issuecomment-7754621",
            "id": 7754621,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/25",
            "updated_at": "2012-08-15T12:32:15Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/7754621",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1710675?v=3",
                "events_url": "https://api.github.com/users/xTraXx/events{/privacy}",
                "followers_url": "https://api.github.com/users/xTraXx/followers",
                "following_url": "https://api.github.com/users/xTraXx/following{/other_user}",
                "gists_url": "https://api.github.com/users/xTraXx/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/xTraXx",
                "id": 1710675,
                "login": "xTraXx",
                "organizations_url": "https://api.github.com/users/xTraXx/orgs",
                "received_events_url": "https://api.github.com/users/xTraXx/received_events",
                "repos_url": "https://api.github.com/users/xTraXx/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/xTraXx/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/xTraXx/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/xTraXx"
            }
        },
        {
            "body": "finally, this solution from dsfgdsfg fix long delay at login. but still send message fail, I will find out why\n\n--- >\n\nWell I would agree with you if I would not get the account_info message with [status] => active and [kind] => free.\n\n\nHere is my code which replaces lines 204-206 in whatsapp.v2.php:\n$authData=base64_encode($ResData);\n$authLen=strlen($authData);\n$wholeLen=$authLen+9;\n$wholeLen=chr($wholeLen>>8).chr($wholeLen&0xff);\n$authLen=chr($authLen>>8).chr($authLen&0xff);\n$Response = $wholeLen.\"\\xf8\\x04\\x86\\xbd\\xa7\\xfd\\x00\".$authLen.$authData;\n$this->send($Response);\n",
            "created_at": "2012-08-15T14:28:06Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/issues/25#issuecomment-7757195",
            "id": 7757195,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/25",
            "updated_at": "2012-08-15T14:28:06Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/7757195",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/551532?v=3",
                "events_url": "https://api.github.com/users/assegaf/events{/privacy}",
                "followers_url": "https://api.github.com/users/assegaf/followers",
                "following_url": "https://api.github.com/users/assegaf/following{/other_user}",
                "gists_url": "https://api.github.com/users/assegaf/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/assegaf",
                "id": 551532,
                "login": "assegaf",
                "organizations_url": "https://api.github.com/users/assegaf/orgs",
                "received_events_url": "https://api.github.com/users/assegaf/received_events",
                "repos_url": "https://api.github.com/users/assegaf/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/assegaf/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/assegaf/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/assegaf"
            }
        },
        {
            "body": "hi, looks like long login delay is fixed, see my other comment. but still cant send message, read can receive message.\nI closed this issue, message me if there is person also has this issue.",
            "created_at": "2012-08-15T19:42:59Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/issues/25#issuecomment-7766889",
            "id": 7766889,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/25",
            "updated_at": "2012-08-15T19:42:59Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/7766889",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/551532?v=3",
                "events_url": "https://api.github.com/users/assegaf/events{/privacy}",
                "followers_url": "https://api.github.com/users/assegaf/followers",
                "following_url": "https://api.github.com/users/assegaf/following{/other_user}",
                "gists_url": "https://api.github.com/users/assegaf/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/assegaf",
                "id": 551532,
                "login": "assegaf",
                "organizations_url": "https://api.github.com/users/assegaf/orgs",
                "received_events_url": "https://api.github.com/users/assegaf/received_events",
                "repos_url": "https://api.github.com/users/assegaf/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/assegaf/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/assegaf/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/assegaf"
            }
        }
    ],
    "comments": 10,
    "comments_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/25/comments",
    "created_at": "2012-08-14T06:12:17Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/551532?v=3",
                "events_url": "https://api.github.com/users/assegaf/events{/privacy}",
                "followers_url": "https://api.github.com/users/assegaf/followers",
                "following_url": "https://api.github.com/users/assegaf/following{/other_user}",
                "gists_url": "https://api.github.com/users/assegaf/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/assegaf",
                "id": 551532,
                "login": "assegaf",
                "organizations_url": "https://api.github.com/users/assegaf/orgs",
                "received_events_url": "https://api.github.com/users/assegaf/received_events",
                "repos_url": "https://api.github.com/users/assegaf/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/assegaf/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/assegaf/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/assegaf"
            },
            "commit_id": null,
            "created_at": "2012-08-15T19:42:59Z",
            "event": "closed",
            "id": 22754419,
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/events/22754419"
        }
    ],
    "events_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/25/events",
    "html_url": "https://github.com/venomous0x/WhatsAPI/issues/25",
    "id": 6209084,
    "labels": [],
    "labels_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/25/labels{/name}",
    "locked": false,
    "milestone": null,
    "number": 25,
    "state": "closed",
    "title": "login took time too long",
    "updated_at": "2012-08-15T19:42:59Z",
    "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/25",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/551532?v=3",
        "events_url": "https://api.github.com/users/assegaf/events{/privacy}",
        "followers_url": "https://api.github.com/users/assegaf/followers",
        "following_url": "https://api.github.com/users/assegaf/following{/other_user}",
        "gists_url": "https://api.github.com/users/assegaf/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/assegaf",
        "id": 551532,
        "login": "assegaf",
        "organizations_url": "https://api.github.com/users/assegaf/orgs",
        "received_events_url": "https://api.github.com/users/assegaf/received_events",
        "repos_url": "https://api.github.com/users/assegaf/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/assegaf/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/assegaf/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/assegaf"
    }
}