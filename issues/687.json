{
    "assignee": null,
    "body": "From a WhatsApp Mobile Client it is possible to see incoming messages via notification or rooted android phone (sqlite db access) without your status showing up as online to others.  Which means the phone is polling messages from the whatsapp server without updating the status to online. I was wondering if there is already a method to do this using the existing WhatsAPI code. If not, is it possible to implement this?\r\n\r\nI've made a bot which connects to the whatsapp server,checks for new messages every 'x' seconds and disconnects. A user who sees the bot via there whatapp client, will keeping seeing bot online / bot lastseen alternating every 'x' seconds.\r\n\r\nWhat I want the bot to do is only show up as online when it has to send an outgoing message. Because that is when whatsapp will forcefully update the bots online status.",
    "closed_at": "2014-04-17T09:47:44Z",
    "comment_data": [
        {
            "body": "comment out this line\r\nhttps://github.com/venomous0x/WhatsAPI/blob/master/src/php/whatsprot.class.php#L1589",
            "created_at": "2014-04-16T07:51:01Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/issues/687#issuecomment-40572200",
            "id": 40572200,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/687",
            "updated_at": "2014-04-16T07:51:01Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/40572200",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1610953?v=3",
                "events_url": "https://api.github.com/users/shirioko/events{/privacy}",
                "followers_url": "https://api.github.com/users/shirioko/followers",
                "following_url": "https://api.github.com/users/shirioko/following{/other_user}",
                "gists_url": "https://api.github.com/users/shirioko/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/shirioko",
                "id": 1610953,
                "login": "shirioko",
                "organizations_url": "https://api.github.com/users/shirioko/orgs",
                "received_events_url": "https://api.github.com/users/shirioko/received_events",
                "repos_url": "https://api.github.com/users/shirioko/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/shirioko/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/shirioko/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/shirioko"
            }
        },
        {
            "body": "brilliant! :) thanx\r\nworks like a charm.. \r\nSo I can now receive messages without showing up as online. But I had assumed when I send a message, I will forcefully been shown as online, which is not the case.\r\n\r\nSo to mimic what happens on a whatsapp mobile client, when a message is sent, I do the following:\r\n```php\r\n$w->sendAvailableForChat();\r\n//$w->pollMessages();\r\n$w->sendPresenceSubscription($from);\r\n//$w->pollMessages();\r\n$w->sendMessageComposing($from);\r\nsleep(1);\r\n//$w->pollMessages();\r\n$w->sendMessagePaused($from);\r\n//$w->pollMessages();\r\n$w->sendMessage($from, $body);\r\n$w->pollMessages();\r\n```\r\n( I'm not sure if it is necessary to uncomment all the commented $w->pollMessages(); )\r\n\r\nTo go offline after 15 seconds of inactivity , I set a timer and call:\r\n```php\r\n$w->sendOfflineStatus();\r\n```\r\nIf there is no activity for more than 60 seconds, whatsapp server stops communicating with the code.\r\nThere are two approaches to counter this, that I have found.\r\n1. Call ```$w->sendPong(time()); ``` within 60 seconds of inactivity (I call it within 30 seconds)\r\n2. Connect, PollMessages, Disconnect...(in a Loop)\r\n\r\nCould you please shed some light as to how a mobile whatsapp client does it. Does it use any of the above or some other way?",
            "created_at": "2014-04-16T17:15:51Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/issues/687#issuecomment-40626028",
            "id": 40626028,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/687",
            "updated_at": "2014-04-16T17:15:51Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/40626028",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1073179?v=3",
                "events_url": "https://api.github.com/users/chemburkar/events{/privacy}",
                "followers_url": "https://api.github.com/users/chemburkar/followers",
                "following_url": "https://api.github.com/users/chemburkar/following{/other_user}",
                "gists_url": "https://api.github.com/users/chemburkar/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/chemburkar",
                "id": 1073179,
                "login": "chemburkar",
                "organizations_url": "https://api.github.com/users/chemburkar/orgs",
                "received_events_url": "https://api.github.com/users/chemburkar/received_events",
                "repos_url": "https://api.github.com/users/chemburkar/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/chemburkar/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/chemburkar/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/chemburkar"
            }
        },
        {
            "body": "The mobile WhatsApp client uses GCM or some other type background push channel to push updates when the device is set to offline i.e. the app is not in foreground. So it makes no sense for the server to keep a connection open when the status is offline.",
            "created_at": "2014-04-16T20:13:04Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/issues/687#issuecomment-40646297",
            "id": 40646297,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/687",
            "updated_at": "2014-04-16T20:13:04Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/40646297",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1610953?v=3",
                "events_url": "https://api.github.com/users/shirioko/events{/privacy}",
                "followers_url": "https://api.github.com/users/shirioko/followers",
                "following_url": "https://api.github.com/users/shirioko/following{/other_user}",
                "gists_url": "https://api.github.com/users/shirioko/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/shirioko",
                "id": 1610953,
                "login": "shirioko",
                "organizations_url": "https://api.github.com/users/shirioko/orgs",
                "received_events_url": "https://api.github.com/users/shirioko/received_events",
                "repos_url": "https://api.github.com/users/shirioko/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/shirioko/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/shirioko/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/shirioko"
            }
        },
        {
            "body": "That makes a lot of sense, i'm guessing andoid,ios,windows phone and bb will have push notifications from their respective providers. I'll have to look up older platforms eg. symbian to see how the mobile client works there.\r\nThanks, your replies have been very helpful and quick.",
            "created_at": "2014-04-17T04:43:09Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/issues/687#issuecomment-40680390",
            "id": 40680390,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/687",
            "updated_at": "2014-04-17T04:43:09Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/40680390",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1073179?v=3",
                "events_url": "https://api.github.com/users/chemburkar/events{/privacy}",
                "followers_url": "https://api.github.com/users/chemburkar/followers",
                "following_url": "https://api.github.com/users/chemburkar/following{/other_user}",
                "gists_url": "https://api.github.com/users/chemburkar/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/chemburkar",
                "id": 1073179,
                "login": "chemburkar",
                "organizations_url": "https://api.github.com/users/chemburkar/orgs",
                "received_events_url": "https://api.github.com/users/chemburkar/received_events",
                "repos_url": "https://api.github.com/users/chemburkar/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/chemburkar/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/chemburkar/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/chemburkar"
            }
        }
    ],
    "comments": 4,
    "comments_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/687/comments",
    "created_at": "2014-04-16T05:42:25Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1610953?v=3",
                "events_url": "https://api.github.com/users/shirioko/events{/privacy}",
                "followers_url": "https://api.github.com/users/shirioko/followers",
                "following_url": "https://api.github.com/users/shirioko/following{/other_user}",
                "gists_url": "https://api.github.com/users/shirioko/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/shirioko",
                "id": 1610953,
                "login": "shirioko",
                "organizations_url": "https://api.github.com/users/shirioko/orgs",
                "received_events_url": "https://api.github.com/users/shirioko/received_events",
                "repos_url": "https://api.github.com/users/shirioko/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/shirioko/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/shirioko/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/shirioko"
            },
            "commit_id": null,
            "created_at": "2014-04-17T09:47:44Z",
            "event": "closed",
            "id": 112659006,
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/events/112659006"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1610953?v=3",
                "events_url": "https://api.github.com/users/shirioko/events{/privacy}",
                "followers_url": "https://api.github.com/users/shirioko/followers",
                "following_url": "https://api.github.com/users/shirioko/following{/other_user}",
                "gists_url": "https://api.github.com/users/shirioko/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/shirioko",
                "id": 1610953,
                "login": "shirioko",
                "organizations_url": "https://api.github.com/users/shirioko/orgs",
                "received_events_url": "https://api.github.com/users/shirioko/received_events",
                "repos_url": "https://api.github.com/users/shirioko/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/shirioko/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/shirioko/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/shirioko"
            },
            "commit_id": null,
            "created_at": "2014-04-17T09:47:48Z",
            "event": "labeled",
            "id": 112659024,
            "label": {
                "color": "cc317c",
                "name": "question"
            },
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/events/112659024"
        }
    ],
    "events_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/687/events",
    "html_url": "https://github.com/venomous0x/WhatsAPI/issues/687",
    "id": 31613943,
    "labels": [
        {
            "color": "cc317c",
            "name": "question",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/labels/question"
        }
    ],
    "labels_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/687/labels{/name}",
    "locked": false,
    "milestone": null,
    "number": 687,
    "state": "closed",
    "title": "Connect & Poll Messages without showing up as online",
    "updated_at": "2014-04-27T16:35:50Z",
    "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/687",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/1073179?v=3",
        "events_url": "https://api.github.com/users/chemburkar/events{/privacy}",
        "followers_url": "https://api.github.com/users/chemburkar/followers",
        "following_url": "https://api.github.com/users/chemburkar/following{/other_user}",
        "gists_url": "https://api.github.com/users/chemburkar/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/chemburkar",
        "id": 1073179,
        "login": "chemburkar",
        "organizations_url": "https://api.github.com/users/chemburkar/orgs",
        "received_events_url": "https://api.github.com/users/chemburkar/received_events",
        "repos_url": "https://api.github.com/users/chemburkar/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/chemburkar/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/chemburkar/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/chemburkar"
    }
}