{
    "assignee": null,
    "body": "From time to time I keep getting this error:\r\n\r\n```\r\nPHP Fatal error:  Uncaught exception 'Exception' with message 'BinTreeNodeReader->readListSize: Invalid token 31' in /home/********/public_html/whatsapp/protocol.class.php:392\r\nStack trace:\r\n#0 /home/********/public_html/whatsapp/protocol.class.php(346): BinTreeNodeReader->readListSize(31)\r\n#1 /home/********/public_html/whatsapp/protocol.class.php(280): BinTreeNodeReader->nextTreeInternal()\r\n#2 /home/********/public_html/whatsapp/whatsprot.class.php(2057): BinTreeNodeReader->nextTree()\r\n#3 /home/********/public_html/whatsapp/whatsprot.class.php(1490): WhatsProt->processInboundData('??????A????????...')\r\n#4 /home/********/public_html/whatsapp/whatsprot.class.php(420): WhatsProt->doLogin(false)\r\n#5 /home/********/public_html/run.php(20): WhatsProt->loginWithPassword('***********...')\r\n#6 {main}\r\n  thrown in /home/********/public_html/whatsapp/protocol.class.php on line 392\r\n```\r\n\r\nWhat is causing this and how can I fix this?",
    "closed_at": null,
    "comment_data": [
        {
            "body": "Post some code.\r\nÂ¿You use \"$w->eventManager()->bind(???,???) into a while?\r\n",
            "created_at": "2013-12-17T15:22:25Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/issues/551#issuecomment-30759366",
            "id": 30759366,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/551",
            "updated_at": "2013-12-17T15:22:25Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/30759366",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/3154948?v=3",
                "events_url": "https://api.github.com/users/RFKDOT/events{/privacy}",
                "followers_url": "https://api.github.com/users/RFKDOT/followers",
                "following_url": "https://api.github.com/users/RFKDOT/following{/other_user}",
                "gists_url": "https://api.github.com/users/RFKDOT/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/RFKDOT",
                "id": 3154948,
                "login": "RFKDOT",
                "organizations_url": "https://api.github.com/users/RFKDOT/orgs",
                "received_events_url": "https://api.github.com/users/RFKDOT/received_events",
                "repos_url": "https://api.github.com/users/RFKDOT/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/RFKDOT/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/RFKDOT/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/RFKDOT"
            }
        },
        {
            "body": "No the eventmanager is called oustide of the while loop.\r\n\r\n```\r\n[...]\r\n$w = new WhatsProt($username, 0, \"xxxxxx\", false);\r\n$w->eventManager()->bind(\"onGetMessage\", \"onMessage\");\r\n$w->eventManager()->bind(\"onGetImage\", \"onImage\");\r\n$w->connect();\r\n$w->loginWithPassword($password);\r\n\r\n$time=1;\r\nwhile($time <= 40)\r\n{\r\n\tif ($time <= 5) {\r\n\t\t$w->pollMessages();\r\n\t} else {\r\n[...]\r\n```\r\n\r\nSince sending and receiving can't be done simultaneously, I always look for new messages the first 5 seconds. Then I process outgoing messages if there are any. When that is done I look for new messages again until the time run == 40 seconds :)",
            "created_at": "2013-12-17T16:58:32Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/issues/551#issuecomment-30768736",
            "id": 30768736,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/551",
            "updated_at": "2013-12-17T16:58:32Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/30768736",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2750761?v=3",
                "events_url": "https://api.github.com/users/Fidelity88/events{/privacy}",
                "followers_url": "https://api.github.com/users/Fidelity88/followers",
                "following_url": "https://api.github.com/users/Fidelity88/following{/other_user}",
                "gists_url": "https://api.github.com/users/Fidelity88/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/Fidelity88",
                "id": 2750761,
                "login": "Fidelity88",
                "organizations_url": "https://api.github.com/users/Fidelity88/orgs",
                "received_events_url": "https://api.github.com/users/Fidelity88/received_events",
                "repos_url": "https://api.github.com/users/Fidelity88/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/Fidelity88/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/Fidelity88/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/Fidelity88"
            }
        },
        {
            "body": "\r\n\r\nThis is mi script very reduced to only receipt msgs y have test:\r\n```PHP\r\n<?php\r\ndefine('PATH', '/home/admon/WB');\r\n\r\nrequire PATH.'/src/WhatsAPI/src/php/whatsprot.class.php';\r\nrequire PATH.'/config.php';\r\n\r\n$w = new WhatsProt(SEND, IMEI, NICK, DEBUG);\r\n$w->Connect();\r\n$w->LoginWithPassword(PASS);\r\n\r\n$w->eventManager()->bind(\"onGetMessage\", \"GetMessage\");\r\n\r\nfunction GetMessage($mynumber, $from, $id, $type, $time, $name, $body){\r\n       echo $mynumber.'|'.$from.'|'.$id.'|'.$type.'|'.$time.'|'.$name.'|'.$body.\"\\n\";\r\n       //process de msg\r\n\r\n}\r\n\r\nwhile(TRUE){\r\n\r\n      $w->PollMessages();\r\n      sleep(1);\r\n\r\n}\r\n?>\r\n```\r\n",
            "created_at": "2013-12-17T21:57:53Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/issues/551#issuecomment-30795454",
            "id": 30795454,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/551",
            "updated_at": "2013-12-17T21:57:53Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/30795454",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/3154948?v=3",
                "events_url": "https://api.github.com/users/RFKDOT/events{/privacy}",
                "followers_url": "https://api.github.com/users/RFKDOT/followers",
                "following_url": "https://api.github.com/users/RFKDOT/following{/other_user}",
                "gists_url": "https://api.github.com/users/RFKDOT/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/RFKDOT",
                "id": 3154948,
                "login": "RFKDOT",
                "organizations_url": "https://api.github.com/users/RFKDOT/orgs",
                "received_events_url": "https://api.github.com/users/RFKDOT/received_events",
                "repos_url": "https://api.github.com/users/RFKDOT/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/RFKDOT/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/RFKDOT/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/RFKDOT"
            }
        },
        {
            "body": "https://github.com/venomous0x/WhatsAPI/issues/456",
            "created_at": "2013-12-18T13:19:20Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/issues/551#issuecomment-30840695",
            "id": 30840695,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/551",
            "updated_at": "2013-12-18T13:19:20Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/30840695",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/604766?v=3",
                "events_url": "https://api.github.com/users/DurtyFree/events{/privacy}",
                "followers_url": "https://api.github.com/users/DurtyFree/followers",
                "following_url": "https://api.github.com/users/DurtyFree/following{/other_user}",
                "gists_url": "https://api.github.com/users/DurtyFree/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/DurtyFree",
                "id": 604766,
                "login": "DurtyFree",
                "organizations_url": "https://api.github.com/users/DurtyFree/orgs",
                "received_events_url": "https://api.github.com/users/DurtyFree/received_events",
                "repos_url": "https://api.github.com/users/DurtyFree/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/DurtyFree/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/DurtyFree/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/DurtyFree"
            }
        },
        {
            "body": "So nobody actually knows what this error is causing is my conclusion now... I'm getting this error even when not receiving or sending out messages, so it would have nothing to do with the content or the time between messages.",
            "created_at": "2013-12-18T14:17:52Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/issues/551#issuecomment-30844463",
            "id": 30844463,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/551",
            "updated_at": "2013-12-18T14:17:52Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/30844463",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2750761?v=3",
                "events_url": "https://api.github.com/users/Fidelity88/events{/privacy}",
                "followers_url": "https://api.github.com/users/Fidelity88/followers",
                "following_url": "https://api.github.com/users/Fidelity88/following{/other_user}",
                "gists_url": "https://api.github.com/users/Fidelity88/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/Fidelity88",
                "id": 2750761,
                "login": "Fidelity88",
                "organizations_url": "https://api.github.com/users/Fidelity88/orgs",
                "received_events_url": "https://api.github.com/users/Fidelity88/received_events",
                "repos_url": "https://api.github.com/users/Fidelity88/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/Fidelity88/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/Fidelity88/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/Fidelity88"
            }
        },
        {
            "body": "I don't understand, but my script are online 3 months and always works perfectly.\r\nReceive messages, video and images from 7 groups with 6-30 participants simultaneously.\r\nSorry for my English",
            "created_at": "2013-12-18T19:06:01Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/issues/551#issuecomment-30870318",
            "id": 30870318,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/551",
            "updated_at": "2013-12-18T19:06:01Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/30870318",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/3154948?v=3",
                "events_url": "https://api.github.com/users/RFKDOT/events{/privacy}",
                "followers_url": "https://api.github.com/users/RFKDOT/followers",
                "following_url": "https://api.github.com/users/RFKDOT/following{/other_user}",
                "gists_url": "https://api.github.com/users/RFKDOT/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/RFKDOT",
                "id": 3154948,
                "login": "RFKDOT",
                "organizations_url": "https://api.github.com/users/RFKDOT/orgs",
                "received_events_url": "https://api.github.com/users/RFKDOT/received_events",
                "repos_url": "https://api.github.com/users/RFKDOT/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/RFKDOT/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/RFKDOT/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/RFKDOT"
            }
        },
        {
            "body": "It does work! But I keep getting errors. I can just ignore the errors, but rather fix it :)",
            "created_at": "2013-12-18T19:48:38Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/issues/551#issuecomment-30874141",
            "id": 30874141,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/551",
            "updated_at": "2013-12-18T19:48:38Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/30874141",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2750761?v=3",
                "events_url": "https://api.github.com/users/Fidelity88/events{/privacy}",
                "followers_url": "https://api.github.com/users/Fidelity88/followers",
                "following_url": "https://api.github.com/users/Fidelity88/following{/other_user}",
                "gists_url": "https://api.github.com/users/Fidelity88/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/Fidelity88",
                "id": 2750761,
                "login": "Fidelity88",
                "organizations_url": "https://api.github.com/users/Fidelity88/orgs",
                "received_events_url": "https://api.github.com/users/Fidelity88/received_events",
                "repos_url": "https://api.github.com/users/Fidelity88/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/Fidelity88/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/Fidelity88/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/Fidelity88"
            }
        },
        {
            "body": "Are you running multiple WhatsProt objects in the same script? WhatsProt class has some static properties used for encryption which don't allow multiple instances of WhatsProt at the same time.",
            "created_at": "2013-12-19T11:22:31Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/issues/551#issuecomment-30921708",
            "id": 30921708,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/551",
            "updated_at": "2013-12-19T11:22:31Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/30921708",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1610953?v=3",
                "events_url": "https://api.github.com/users/shirioko/events{/privacy}",
                "followers_url": "https://api.github.com/users/shirioko/followers",
                "following_url": "https://api.github.com/users/shirioko/following{/other_user}",
                "gists_url": "https://api.github.com/users/shirioko/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/shirioko",
                "id": 1610953,
                "login": "shirioko",
                "organizations_url": "https://api.github.com/users/shirioko/orgs",
                "received_events_url": "https://api.github.com/users/shirioko/received_events",
                "repos_url": "https://api.github.com/users/shirioko/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/shirioko/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/shirioko/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/shirioko"
            }
        },
        {
            "body": "Nope, only 1. So kinda weird I still get errors",
            "created_at": "2013-12-19T16:25:31Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/issues/551#issuecomment-30942613",
            "id": 30942613,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/551",
            "updated_at": "2013-12-19T16:25:31Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/30942613",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2750761?v=3",
                "events_url": "https://api.github.com/users/Fidelity88/events{/privacy}",
                "followers_url": "https://api.github.com/users/Fidelity88/followers",
                "following_url": "https://api.github.com/users/Fidelity88/following{/other_user}",
                "gists_url": "https://api.github.com/users/Fidelity88/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/Fidelity88",
                "id": 2750761,
                "login": "Fidelity88",
                "organizations_url": "https://api.github.com/users/Fidelity88/orgs",
                "received_events_url": "https://api.github.com/users/Fidelity88/received_events",
                "repos_url": "https://api.github.com/users/Fidelity88/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/Fidelity88/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/Fidelity88/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/Fidelity88"
            }
        },
        {
            "body": "Same issue here. I'm using  ProcessNode  class  and method \"setNewMessageBind\"  \r\nIf you send messages too quickly , I catch following exceptions messages.\r\n\r\n2014-01-25T13:32:19+01:00 INFO (6): BinTreeNodeReader->readListSize: Invalid token 154\r\n2014-01-25T13:32:20+01:00 INFO (6): BinTreeNodeReader->readListSize: Invalid token 5\r\n2014-01-25T13:32:21+01:00 INFO (6): BinTreeNodeReader->readListSize: Invalid token 31\r\n2014-01-25T13:32:22+01:00 INFO (6): BinTreeNodeReader->readListSize: Invalid token 79\r\n2014-01-25T13:32:23+01:00 INFO (6): BinTreeNodeReader->readListSize: Invalid token 180\r\n",
            "created_at": "2014-01-25T12:42:55Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/issues/551#issuecomment-33288087",
            "id": 33288087,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/551",
            "updated_at": "2014-01-25T12:42:55Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/33288087",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/188766?v=3",
                "events_url": "https://api.github.com/users/scramatte/events{/privacy}",
                "followers_url": "https://api.github.com/users/scramatte/followers",
                "following_url": "https://api.github.com/users/scramatte/following{/other_user}",
                "gists_url": "https://api.github.com/users/scramatte/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scramatte",
                "id": 188766,
                "login": "scramatte",
                "organizations_url": "https://api.github.com/users/scramatte/orgs",
                "received_events_url": "https://api.github.com/users/scramatte/received_events",
                "repos_url": "https://api.github.com/users/scramatte/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scramatte/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scramatte/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scramatte"
            }
        },
        {
            "body": "Hello, does somebody know why do I get this?\r\n\r\nPHP Fatal error:  Call to undefined method WhatsProt::Message() in /var/whatsapp/whatsapp_whatsapi_send.php on line 14\r\n",
            "created_at": "2014-03-22T15:40:25Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/issues/551#issuecomment-38354729",
            "id": 38354729,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/551",
            "updated_at": "2014-03-22T15:40:25Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/38354729",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/7021165?v=3",
                "events_url": "https://api.github.com/users/escalanterj/events{/privacy}",
                "followers_url": "https://api.github.com/users/escalanterj/followers",
                "following_url": "https://api.github.com/users/escalanterj/following{/other_user}",
                "gists_url": "https://api.github.com/users/escalanterj/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/escalanterj",
                "id": 7021165,
                "login": "escalanterj",
                "organizations_url": "https://api.github.com/users/escalanterj/orgs",
                "received_events_url": "https://api.github.com/users/escalanterj/received_events",
                "repos_url": "https://api.github.com/users/escalanterj/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/escalanterj/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/escalanterj/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/escalanterj"
            }
        },
        {
            "body": "It's because your code is horribly outdated. Method names were changed like a year ago?",
            "created_at": "2014-03-23T21:03:28Z",
            "html_url": "https://github.com/venomous0x/WhatsAPI/issues/551#issuecomment-38397193",
            "id": 38397193,
            "issue_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/551",
            "updated_at": "2014-03-23T21:03:28Z",
            "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/comments/38397193",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1610953?v=3",
                "events_url": "https://api.github.com/users/shirioko/events{/privacy}",
                "followers_url": "https://api.github.com/users/shirioko/followers",
                "following_url": "https://api.github.com/users/shirioko/following{/other_user}",
                "gists_url": "https://api.github.com/users/shirioko/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/shirioko",
                "id": 1610953,
                "login": "shirioko",
                "organizations_url": "https://api.github.com/users/shirioko/orgs",
                "received_events_url": "https://api.github.com/users/shirioko/received_events",
                "repos_url": "https://api.github.com/users/shirioko/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/shirioko/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/shirioko/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/shirioko"
            }
        }
    ],
    "comments": 12,
    "comments_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/551/comments",
    "created_at": "2013-12-17T11:38:47Z",
    "event_data": [],
    "events_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/551/events",
    "html_url": "https://github.com/venomous0x/WhatsAPI/issues/551",
    "id": 24415049,
    "labels": [],
    "labels_url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/551/labels{/name}",
    "locked": false,
    "milestone": null,
    "number": 551,
    "state": "open",
    "title": "Invalid token",
    "updated_at": "2014-03-23T21:03:28Z",
    "url": "https://api.github.com/repos/venomous0x/WhatsAPI/issues/551",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/2750761?v=3",
        "events_url": "https://api.github.com/users/Fidelity88/events{/privacy}",
        "followers_url": "https://api.github.com/users/Fidelity88/followers",
        "following_url": "https://api.github.com/users/Fidelity88/following{/other_user}",
        "gists_url": "https://api.github.com/users/Fidelity88/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/Fidelity88",
        "id": 2750761,
        "login": "Fidelity88",
        "organizations_url": "https://api.github.com/users/Fidelity88/orgs",
        "received_events_url": "https://api.github.com/users/Fidelity88/received_events",
        "repos_url": "https://api.github.com/users/Fidelity88/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/Fidelity88/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/Fidelity88/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/Fidelity88"
    }
}